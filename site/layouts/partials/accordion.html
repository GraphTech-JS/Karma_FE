{{ $title := .title }}
{{ $items := .items }}
{{ $className := .className | default "" }}
{{ $titleClassName := .titleClassName | default "" }}

<section class="relative flex flex-col items-center {{ $className }}"
    aria-labelledby="accordion-heading">
    <div class="w-full max-w-[1280px] px-[20px]">
        {{ if $title }}
        <h2 id="accordion-heading"
            class="font-[Unbounded] font-medium text-[clamp(24px,4vw,40px)] text-center lg:!text-left text-[#020303] mb-[clamp(20px,3vw,24px)] {{ $titleClassName }}">
            {{ $title }}
        </h2>
        {{ end }}
        <div class="w-full mx-auto flex flex-col gap-[clamp(20px,3vw,30px)]"
            data-accordion-list role="list" aria-label="Список питань та відповідей">
            {{ range $index, $item := $items }}
            <div class="accordion-wrapper" role="listitem">
                <details class="accordion-root group border-b border-[#303030]">
                    <summary class="flex cursor-pointer select-none accordion-summary"
                        aria-label="Розгорнути відповідь на питання: {{ .question }}">
                        <h3 class="font-[Montserrat] text-[clamp(16px,2vw,24px)] font-medium ">
                            {{ .question }}</h3>
                        <img src="/img/arrow.svg" alt="Іконка розгортання" width="20" height="20"
                            class="accordion-icon" />
                    </summary>
                    <div class="accordion-content">
                        <p class="font-[Montserrat] text-[clamp(16px,2vw,20px)] font-normal text-[#1f2937]">
                            {{ .answer }}
                        </p>
                    </div>
                </details>
            </div>
            {{ end }}
        </div>
    </div>
</section>

<style>
    .accordion-wrapper {
        width: 100%;
    }

  



    .accordion-root {
        max-width: 100%;
        margin: 0 auto;
    }

    .accordion-summary {
        position: relative !important;
        display: flex !important;
        align-items: center !important;
        padding: clamp(12px, 2vw, 19px) clamp(20px, 4vw, 45px) !important;
        transition: background-color 400ms ease, color 400ms ease !important;
        background: #fff !important;
        color: #020303 !important;
        cursor: pointer;
        min-height: clamp(60px, 8vw, 80px) !important;
    }

    .accordion-summary::-webkit-details-marker {
        display: none;
    }

    .accordion-summary::marker {
        content: '';
    }

    .accordion-root[open] .accordion-summary {
        background: #ba0108 !important;
        color: #fff !important;
    }

    .accordion-icon {
        margin-left: auto !important;
        width: clamp(20px, 3vw, 33px) !important;
        height: clamp(12px, 2vw, 18px) !important;
        transform: rotate(0deg) !important;
        transition: transform 500ms ease-in-out, filter 300ms ease-in-out !important;
        filter: brightness(0) !important;
    }

    .accordion-root[open] .accordion-icon {
        transform: rotate(-180deg) !important;
        filter: brightness(0) invert(1) !important;
    }

    .accordion-root::details-content {
        transition: block-size 600ms, content-visibility 600ms allow-discrete !important;
        overflow: hidden !important;
        block-size: 0 !important;
        inline-size: 100% !important;
        content-visibility: hidden !important;
    }

    .accordion-root[open]::details-content {
        block-size: auto !important;
        content-visibility: visible !important;
    }

    /* animated content: start collapsed */
    .accordion-content {
        overflow: hidden !important;
        max-height: 0;
        opacity: 0;
        /* slower, same duration for open and close */
        transition: max-height 600ms cubic-bezier(.2,.8,.2,1), opacity 600ms ease;
        width: 100% !important;
        padding: 0 clamp(20px, 4vw, 46px) !important;
    }

    /* when details is open we will set inline max-height from JS and set opacity via this rule as fallback */
    .accordion-root[open] .accordion-content {
        opacity: 1;
        padding: clamp(8px, 2vw, 12px) clamp(20px, 4vw, 46px) !important;
    }



    @media (max-width: 1240px) {
        .accordion-summary {
            padding-left: 24px !important;
            padding-right: 24px !important;
        }
    }

    @media (max-width: 960px) {
        .accordion-summary {
            padding-left: 20px !important;
            padding-right: 20px !important;
        }
    }

    @media (max-width: 800px) {
        .accordion-summary {
            padding-left: 16px !important;
            padding-right: 16px !important;
        }
    }

    @media (max-width: 1024px) {
        .accordion-summary {
            padding-left: clamp(16px, 3vw, 20px) !important;
            padding-right: clamp(16px, 3vw, 20px) !important;
            min-height: clamp(60px, 8vw, 70px) !important;
        }

        .accordion-content {
            padding: clamp(8px, 2vw, 10px) clamp(16px, 3vw, 20px) !important;
        }

        .accordion-icon {
            width: clamp(20px, 3vw, 25px) !important;
            height: clamp(12px, 2vw, 15px) !important;
        }
    }

    @media (max-width: 1240px) {
        .accordion-summary {
            padding-left: 24px !important;
            padding-right: 24px !important;
        }
    }

    @media (max-width: 960px) {
        .accordion-summary {
            padding-left: 20px !important;
            padding-right: 20px !important;
        }
    }

    @media (max-width: 800px) {
        .accordion-summary {
            padding-left: 16px !important;
            padding-right: 16px !important;
        }
    }

    @media (max-width: 560px) {
        .accordion-wrapper {
            margin: 0 auto !important;
        }

        .accordion-root {
            max-width: 100% !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        .accordion-content {
            padding: clamp(8px, 2vw, 10px) !important;
        }

        .accordion-summary {
            padding-left: clamp(12px, 3vw, 16px) !important;
            padding-right: clamp(12px, 3vw, 16px) !important;
        }

        .accordion-icon {
            align-self: flex-start !important;
            margin-top: 0 !important;
        }

        .accordion-question-text {
            display: -webkit-box !important;
            /* standard property for newer browsers */
            line-clamp: 3 !important;
            -webkit-line-clamp: 3 !important;
            -webkit-box-orient: vertical !important;
            overflow: hidden !important;
            padding-right: 6px !important;
            text-align: left !important;
        }
    }
</style>

<script>
(function () {
    var lists = document.querySelectorAll('[data-accordion-list]');

    function animateDetails(details) {
        var content = details.querySelector('.accordion-content');
        if (!content) return;

        if (details.open) {
            // Открытие - анимируем от 0 до полной высоты
            content.style.display = 'block';
            content.style.maxHeight = '0px';
            content.style.opacity = '0';
            
            // Измеряем высоту контента
            var height = content.scrollHeight;
            
            // Запускаем анимацию в следующем кадре
            requestAnimationFrame(function () {
                content.style.maxHeight = height + 'px';
                content.style.opacity = '1';
            });

            // После завершения анимации убираем фиксированную высоту
            var onOpenEnd = function (e) {
                if (e.propertyName === 'max-height' && details.open) {
                    content.style.maxHeight = 'none';
                    content.removeEventListener('transitionend', onOpenEnd);
                }
            };
            content.addEventListener('transitionend', onOpenEnd);
            
        } else {
            // Закрытие - анимируем от текущей высоты к 0
            var currentHeight = content.scrollHeight;
            content.style.maxHeight = currentHeight + 'px';
            content.style.opacity = '1';
            
            // Принудительно применяем стили, затем анимируем к 0
            requestAnimationFrame(function () {
                requestAnimationFrame(function () {
                    content.style.maxHeight = '0px';
                    content.style.opacity = '0';
                });
            });

            // После завершения анимации скрываем элемент
            var onCloseEnd = function (e) {
                if (e.propertyName === 'max-height' && !details.open) {
                    content.style.display = 'none';
                    content.removeEventListener('transitionend', onCloseEnd);
                }
            };
            content.addEventListener('transitionend', onCloseEnd);
        }
    }

    lists.forEach(function (list) {
        var items = Array.prototype.slice.call(list.querySelectorAll('.accordion-root'));

        items.forEach(function (item) {
            // Устанавливаем начальное состояние
            var content = item.querySelector('.accordion-content');
            if (content) {
                if (item.open) {
                    content.style.display = 'block';
                    content.style.maxHeight = 'none';
                    content.style.opacity = '1';
                } else {
                    content.style.display = 'none';
                    content.style.maxHeight = '0px';
                    content.style.opacity = '0';
                }
            }

            // Обработчик клика по summary
            var summaryEl = item.querySelector('summary');
            if (summaryEl) {
                summaryEl.addEventListener('click', function (ev) {
                    ev.preventDefault();

                    var willOpen = !item.open;

                    if (willOpen) {
                        // Закрываем другие открытые элементы
                        items.forEach(function (other) {
                            if (other !== item && other.open) {
                                other.open = false;
                                animateDetails(other);
                            }
                        });
                        item.open = true;
                    } else {
                        item.open = false;
                    }

                    // Анимируем текущий элемент
                    animateDetails(item);
                });
            }
        });
    });
})();
</script>