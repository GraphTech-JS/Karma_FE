{{ $title := .title }}
{{ $items := .items }}
{{ $className := .className | default "" }}
{{ $titleClassName := .titleClassName | default "" }}
{{ $mode := .mode | default "" }}
{{ $isFirst := .isFirst | default false }}

<section class="relative flex flex-col items-center {{ $className }}" aria-labelledby="accordion-heading">
    <div class="w-full max-w-[1280px] px-[20px] {{ if eq $mode " faq" }}faq-accordion-container{{ end }}" {{ if eq
        $mode "faq" }} {{ if not $isFirst }}
        style="margin-top:clamp(60px,8vw,122px)!important; margin-bottom:0!important;" {{ else }}
        style="margin-top:clamp(60px,6vw,80px)!important; margin-bottom:clamp(60px,10vw,134px)!important;" {{ end }} {{
        end }}>

        {{ if $title }}
        <h2 id="accordion-heading" class="font-[Unbounded] font-medium text-[clamp(24px,4vw,40px)] 
      {{ if .titleAlign }}text-{{ .titleAlign }}{{ else }}text-center{{ end }} 
      text-[#020303] mb-[clamp(20px,3vw,24px)] {{ $titleClassName }}">
            {{ $title }}
        </h2>
        {{ end }}
        <div class="w-full mx-auto flex flex-col gap-[clamp(20px,3vw,30px)]" data-accordion-list role="list"
            aria-label="Список питань та відповідей">
            {{ range $index, $item := $items }}
            <div class="accordion-wrapper" role="listitem">
                <details class="accordion-root group border-b border-[#303030]">
                    <summary
                        class="flex !justify-center items-start md:items-center cursor-pointer p-[15px] select-none accordion-summary"
                        aria-label="Розгорнути відповідь на питання: {{ .question }}">
                        <h3
                            class="md:font-[Montserrat] font-[Unbounded] text-[16px] md:text-[20px] lg:text-[24px] leading-[120%] font-medium accordion-question-text">
                            {{ .question }}</h3>
                        <svg class="accordion-icon" width="20" height="12" viewBox="0 0 20 12" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1L10 10L19 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </summary>
                    <div class="accordion-content-wrapper js-accordion-content">
                        <p
                            class="md:font-[Montserrat] font-[Unbounded] py-[16px] px-[21px] text-[clamp(16px,2vw,20px)] text-[#000000]">
                            {{ .answer | safeHTML }}
                        </p>
                    </div>
                </details>
            </div>
            {{ end }}
        </div>
    </div>
</section>


<script>
    (function () {
        function initAccordion() {
            var lists = document.querySelectorAll('[data-accordion-list]');
            if (!lists || lists.length === 0) return;
            lists.forEach(function (list) {
                var items = Array.prototype.slice.call(
                    list.querySelectorAll('.accordion-root')
                );
                items.forEach(function (item) {
                    var contentWrapper = item.querySelector('.accordion-content-wrapper');
                    contentWrapper.style.overflow = "hidden";
                    contentWrapper.style.transition = "max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.1s";
                    if (item.open) {
                        contentWrapper.style.maxHeight = contentWrapper.scrollHeight + "px";
                        contentWrapper.style.opacity = "1";
                        item.classList.add('is-open');
                        requestAnimationFrame(function () {
                            setTimeout(function () {
                                if (item.open) contentWrapper.style.maxHeight = '';
                            }, 50);
                        });
                    } else {
                        contentWrapper.style.maxHeight = "0px";
                        contentWrapper.style.opacity = "0";
                        item.classList.remove('is-open');
                    }
                    item._animating = false;

                    function smoothClose() {
                        if (item._animating) return;
                        item._animating = true;

                        var startHeight = contentWrapper.scrollHeight;
                        contentWrapper.style.maxHeight = startHeight + 'px';
                        item.classList.remove('is-open');

                        requestAnimationFrame(() => {
                            requestAnimationFrame(() => {
                                contentWrapper.style.maxHeight = '0px';
                                contentWrapper.style.opacity = '0';
                            });
                        });
                        setTimeout(function () {
                            item.open = false;
                            item._animating = false;
                        }, 400);
                    }

                    function smoothOpen() {
                        if (item._animating) return;
                        item._animating = true;

                        // Close all other accordions with animation
                        items.forEach(function (otherItem) {
                            if (otherItem !== item && otherItem.classList.contains('is-open') && !otherItem._animating) {
                                otherItem._animating = true;
                                var otherWrapper = otherItem.querySelector('.accordion-content-wrapper');
                                var otherHeight = otherWrapper.scrollHeight;
                                otherWrapper.style.maxHeight = otherHeight + 'px';
                                otherWrapper.offsetHeight; // force reflow

                                otherItem.classList.remove('is-open');
                                requestAnimationFrame(function () {
                                    otherWrapper.style.maxHeight = '0px';
                                    otherWrapper.style.opacity = '0';
                                });

                                setTimeout(function () {
                                    otherItem.open = false;
                                    otherItem._animating = false;
                                }, 400);
                            }
                        });

                        item.open = true;
                        contentWrapper.style.maxHeight = '0px';
                        contentWrapper.style.opacity = '0';

                        var full = contentWrapper.scrollHeight;
                        item.classList.add('is-open');

                        requestAnimationFrame(function () {
                            contentWrapper.style.maxHeight = full + 'px';
                            contentWrapper.style.opacity = '1';
                        });



                        setTimeout(function () {
                            if (item.classList.contains('is-open')) {
                                contentWrapper.style.maxHeight = 'auto';
                            }
                            item._animating = false;
                        }, 400);
                    }

                    var summary = item.querySelector('summary');
                    if (summary) {
                        summary.addEventListener('click', function (e) {
                            e.preventDefault();
                            if (item._animating) return;
                            if (item.classList.contains('is-open')) {
                                smoothClose();
                            } else {
                                smoothOpen();
                            }
                        });
                    }
                });
            });
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAccordion);
        } else {
            initAccordion();
        }
    })();
</script>

<style>
    .kit-container {
     padding: 0 21px !important;
    }

    .kit-title {
        font-weight: 600 !important;
        margin-bottom: 16px !important;
        font-size: 20px !important;
        color: #1f2937 !important;
        font-family: 'Unbounded', sans-serif !important;
    }

    @media (min-width: 768px) {
        .kit-title {
            font-family: 'Montserrat', sans-serif !important;
        }
    }

    .kit-item {
        padding: 12px 0 12px 32px !important;
        position: relative !important;
        border-bottom: 1px solid #f3f4f6 !important;
        font-size: 16px !important;
        line-height: 1.5 !important;
        color: #374151 !important;
        transition: all 0.2s ease !important;
        font-family: 'Unbounded', sans-serif !important;
    }

    @media (min-width: 768px) {
        .kit-item {
            font-family: 'Montserrat', sans-serif!important;
        }
    }

    .kit-item:before {
        content: "✓";
        position: absolute !important;
        left: 0;
        color: #ba0108 !important;
        font-weight: bold !important;
        font-size: 16px !important;
        top: 12px !important;
    }
</style>