{{ $title := .title }} {{ $items := .items }} {{ $isFirst := .isFirst }}

<section class="flex relative flex-col items-center bg-white" aria-labelledby="faq-accordion-heading">
    <div class="faq-accordion-container w-full max-w-[min(1237px,90vw)] px-[clamp(20px,4vw,40px)]" {{ if not $isFirst
        }}style="margin-top: clamp(40px,6vw,80px) !important; margin-bottom: 0!important;" {{ else
        }}style="margin-top: clamp(60px,8vw,122px) !important; margin-bottom: clamp(60px,10vw,134px) !important;" {{ end
        }}>
        <h2 id="faq-accordion-heading"
            class="faq-title font-[Unbounded] font-medium text-[clamp(20px,4vw,40px)] text-center text-[#020303] mb-[clamp(20px,3vw,30px)]">
            {{ $title }}
        </h2>
        <div class="w-full flex flex-col gap-[20px] max-w-[1280px]" data-accordion-list
            role="list" aria-label="Список питань та відповідей">
            {{ range $index, $item := $items }}
            <div class="faq-acc-wrapper" role="listitem">
                <details class="faq-acc-root group border-b border-[#303030]">
                    <summary class="flex cursor-pointer select-none faq-acc-summary"
                        aria-label="Розгорнути відповідь на питання: {{ .question }}">
                        <h3
                            class="font-[Unbounded] md:font-[Montserrat] lg:font-[Montserrat] text-[clamp(14px,2vw,24px)] font-medium w-full">
                            {{ .question }}
                        </h3>
                        <img src="/img/arrow.svg" alt="Іконка розгортання" width="20" height="20"
                            class="faq-acc-icon" />
                    </summary>
                    <div class="faq-acc-content-wrapper js-accordion-content">
                        <p class="font-[Montserrat] text-[clamp(14px,2vw,20px)] font-normal text-[#1f2937] faq-acc-content">
                            {{ .answer }}
                        </p>
                    </div>
                </details>
            </div>
            {{ end }}
        </div>
    </div>
</section>

<style>
    .faq-acc-wrapper {
        width: 100%;
        margin-bottom: clamp(15px, 2vw, 20px);
    }

    .faq-acc-root {
        max-width: 100%;
        margin: 0 auto;
    }

    .faq-acc-summary {
        position: relative !important;
        display: flex !important;
        align-items: center !important;
        padding: clamp(15px, 3vw, 45px) clamp(20px, 4vw, 45px) !important;
        transition: background-color 400ms ease, color 400ms ease !important;
        background: #fff !important;
        color: #020303 !important;
        cursor: pointer;
        min-height: clamp(60px, 8vw, 80px) !important;
    }

    .faq-acc-summary::-webkit-details-marker {
        display: none;
    }

    .faq-acc-summary::marker {
        content: '';
    }

    /* Теперь этот стиль будет применяться при наличии класса 'is-open' на faq-acc-root */
    .faq-acc-root.is-open .faq-acc-summary {
        background: #ba0108 !important;
        color: #fff !important;
    }

    .faq-acc-spacer {
        flex: 0 0 clamp(30px, 6vw, 80px) !important;
    }

    .faq-acc-icon {
        margin-left: auto !important;
        width: clamp(20px, 3vw, 33px) !important;
        height: clamp(12px, 2vw, 18px) !important;
        transform: rotate(0deg) !important;
        transition: transform 500ms ease-in-out, filter 300ms ease-in-out !important;
        filter: brightness(0) !important;
        align-self: flex-start !important;
    }

    /* Теперь этот стиль будет применяться при наличии класса 'is-open' на faq-acc-root */
    .faq-acc-root.is-open .faq-acc-icon {
        transform: rotate(-180deg) !important;
        filter: brightness(0) invert(1) !important;
    }

    /* Скрываем контент по умолчанию и добавляем переход */
    .js-accordion-content {
        overflow: hidden;
        max-height: 0;
        transition: max-height 0.3s ease-out, padding 0.3s ease-out; /* Анимируем padding тоже */
        width: 100% !important;
        padding: 0 clamp(10px, 2vw, 46px); /* Начальный padding по бокам, верхний и нижний 0 */
    }

    /* Когда аккордеон открыт, устанавливаем padding */
    .js-accordion-content.is-expanded { /* Изменил класс, чтобы избежать конфликтов */
        padding-top: clamp(10px, 2vw, 46px);
        padding-bottom: clamp(10px, 2vw, 46px);
    }

    .faq-acc-content {
        /* Убираем весь padding из faq-acc-content, он теперь в wrapper */
        padding: 0 !important;
        opacity: 1;
    }


    /* Responsive breakpoints for better control */
    @media (min-width: 640px) {
        .faq-acc-summary {
            padding-left: clamp(24px, 4vw, 45px) !important;
            padding-right: clamp(24px, 4vw, 45px) !important;
        }
    }

    @media (min-width: 768px) {
        .faq-acc-summary {
            padding-left: clamp(30px, 5vw, 45px) !important;
            padding-right: clamp(30px, 5vw, 45px) !important;
        }
    }

    @media (min-width: 1024px) {
        .faq-acc-summary {
            padding-left: clamp(35px, 6vw, 45px) !important;
            padding-right: clamp(35px, 6vw, 45px) !important;
        }
    }

    @media (min-width: 1280px) {
        .faq-acc-summary {
            padding-left: 45px !important;
            padding-right: 45px !important;
        }
    }

    /* Mobile specific adjustments */
    @media (max-width: 640px) {
        .faq-accordion-container {
            margin-top: clamp(40px, 8vw, 60px) !important;
            margin-bottom: clamp(40px, 8vw, 60px) !important;
        }

        .faq-acc-wrapper {
            width: 100% !important;
            margin: 0 auto !important;
        }

        .faq-acc-root {
            max-width: 100% !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        .js-accordion-content {
            padding: 0 clamp(8px, 2vw, 12px) !important;
        }

        .js-accordion-content.is-expanded {
            padding-top: clamp(8px, 2vw, 12px) !important;
            padding-bottom: clamp(8px, 2vw, 12px) !important;
        }

        .faq-acc-summary {
            padding: clamp(10px, 3vw, 15px) !important;
        }

        .faq-acc-icon {
            align-self: flex-start !important;
            margin-top: 0 !important;
        }
    }
</style>

<script>
    (function () {
        var lists = document.querySelectorAll('[data-accordion-list]');
        lists.forEach(function (list) {
            var items = Array.prototype.slice.call(
                list.querySelectorAll('.faq-acc-root')
            );

            items.forEach(function (item) {
                var summary = item.querySelector('.faq-acc-summary');
                var contentWrapper = item.querySelector('.js-accordion-content');
                var content = item.querySelector('.faq-acc-content'); // Сама p внутри wrapper

                // Функция для открытия аккордеона
                function openAccordion(targetItem) {
                    var targetContentWrapper = targetItem.querySelector('.js-accordion-content');
                    var targetContent = targetItem.querySelector('.faq-acc-content');

                    targetItem.classList.add('is-open'); // Добавляем класс для summary и иконки
                    targetContentWrapper.classList.add('is-expanded'); // Добавляем класс для padding
                    targetContentWrapper.style.maxHeight = targetContent.scrollHeight + targetContentWrapper.offsetHeight + 'px';
                }

                // Функция для закрытия аккордеона
                function closeAccordion(targetItem) {
                    var targetContentWrapper = targetItem.querySelector('.js-accordion-content');

                    targetContentWrapper.style.maxHeight = '0';
                    targetContentWrapper.classList.remove('is-expanded');

                    targetContentWrapper.addEventListener('transitionend', function handler() {
                        targetItem.classList.remove('is-open'); // Удаляем класс после завершения анимации
                        targetContentWrapper.removeEventListener('transitionend', handler);
                    }, { once: true });
                }

                // Инициализация: если аккордеон уже открыт (например, с сервера), плавно открыть его
                if (item.hasAttribute('open')) { // Проверяем атрибут 'open'
                    // Временно убираем transition, чтобы сразу установить maxHeight, потом возвращаем
                    contentWrapper.style.transition = 'none';
                    openAccordion(item); // Используем функцию openAccordion для инициализации
                    void contentWrapper.offsetHeight; // Force reflow
                    contentWrapper.style.transition = ''; // Восстанавливаем transition
                }

                summary.addEventListener('click', function (e) {
                    e.preventDefault(); // Предотвращаем стандартное поведение details/summary

                    // Проверяем, открыт ли аккордеон по наличию класса 'is-open'
                    if (item.classList.contains('is-open')) {
                        // Если аккордеон открыт, закрываем его
                        closeAccordion(item);
                    } else {
                        // Если аккордеон закрыт, открываем его и закрываем остальные
                        items.forEach(function (other) {
                            if (other !== item && other.classList.contains('is-open')) {
                                closeAccordion(other);
                            }
                        });
                        openAccordion(item);
                    }
                });
            });
        });
    })();
</script>