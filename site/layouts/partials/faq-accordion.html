{{ $title := .title }} {{ $items := .items }} {{ $isFirst := .isFirst }}

<section class="flex relative flex-col items-center bg-white" aria-labelledby="faq-accordion-heading">
    <div class="faq-accordion-container w-full max-w-[1280px] px-[20px]" {{ if not $isFirst
        }}style="margin-top: clamp(40px,6vw,80px) !important; margin-bottom: 0!important;" {{ else
        }}style="margin-top: clamp(60px,8vw,122px) !important; margin-bottom: clamp(60px,10vw,134px) !important;" {{ end
        }}>
        <h2 id="faq-accordion-heading"
            class="faq-title font-[Unbounded] font-medium text-[24px] md:text-[32px]  lg:text-[40px] text-center text-[#020303] mb-[clamp(20px,3vw,30px)]">
            {{ $title }}
        </h2>
        <div class="w-full flex flex-col gap-[20px] max-w-[1280px]" data-accordion-list
            role="list" aria-label="Список питань та відповідей">
            {{ range $index, $item := $items }}
            <div class="faq-acc-wrapper" role="listitem">
                <details class="faq-acc-root group border-b border-[#020303]">
                    <summary class="flex !justify-center items-start md:items-center  cursor-pointer select-none faq-acc-summary py-[18px] px-[15px] lg:px-[45px]"
                        aria-label="Розгорнути відповідь на питання: {{ .question }}">
                        <h3
                            class="font-[Unbounded] md:font-[Montserrat] text-[16px] md:text-[20px] font-medium w-full">
                            {{ .question }}
                        </h3>
                        <img src="/img/arrow.svg" alt="Іконка розгортання" width="20" height="20"
                            class="faq-acc-icon" />
                    </summary>
                    <div class="faq-acc-content-wrapper js-accordion-content">
                        <p class="font-[Montserrat] text-[20px] font-normal text-[#000000] faq-acc-content py-[16px] pl-[40px]">
                            {{ .answer }}
                        </p>
                    </div>
                </details>
            </div>
            {{ end }}
        </div>
    </div>
</section>

<style>
    .faq-acc-wrapper {
        width: 100%;
        margin-bottom: clamp(15px, 2vw, 20px);
    }

    .faq-acc-root {
        max-width: 100%;
        margin: 0 auto;
    }

    .faq-acc-summary {
        position: relative !important;
    /* background transitions smoothly; color transition overridden for immediate changes */
    transition: background-color 400ms ease !important;
        background: #fff !important;
        color: #020303 !important;
        cursor: pointer;
        min-height: clamp(60px, 8vw, 80px) !important;
    }

    .faq-acc-summary::-webkit-details-marker {
        display: none;
    }

    .faq-acc-summary::marker {
        content: '';
    }

    /* Use JS-driven class to control visual open state */
    .faq-acc-root.is-open .faq-acc-summary {
        background: #ba0108 !important;
        color: #fff !important;
    }

    .faq-acc-spacer {
        flex: 0 0 clamp(30px, 6vw, 80px) !important;
    }

    .faq-acc-icon {
        margin-left: auto !important;
        width: clamp(20px, 3vw, 33px) !important;
        height: clamp(12px, 2vw, 18px) !important;
        transform: rotate(0deg) !important;
        /* match content timing for rotation; make filter change immediate when not open */
        transition: transform 450ms ease-in-out !important;
        filter: brightness(0) !important;
    }

    /* removed `[open]`-based icon rule to avoid style conflict with JS-driven `.is-open` */

    /* Use class-based control so JS can animate arrow in sync with content */
    .faq-acc-root.is-open .faq-acc-icon {
        transform: rotate(-180deg) !important;
        filter: brightness(0) invert(1) !important;
    }

    /* When not open, ensure color changes (text/icon filter) are immediate */
    .faq-acc-root:not(.is-open) .faq-acc-summary {
        color: #020303 !important;
        transition: color 0ms !important;
    }

    .faq-acc-root:not(.is-open) .faq-acc-icon {
        filter: brightness(0) !important;
        transition: filter 0ms !important;
    }

    /* removed ::details-content rules because they conflicted with JS animation control */

    .faq-acc-content {
        overflow: visible !important;
        max-height: none !important;
        opacity: 1 !important;
        transition: none !important;
        width: 100% !important;
    }



    @media (max-width: 640px) {
        .faq-accordion-container {
            margin-top: clamp(40px, 8vw, 60px) !important;
            margin-bottom: clamp(40px, 8vw, 60px) !important;
        }

        .faq-acc-wrapper {
            width: 100% !important;
            margin: 0 auto !important;
        }

        .faq-acc-root {
            max-width: 100% !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        .faq-acc-content {
            padding: clamp(8px, 2vw, 12px) !important;
        }

   

        .faq-acc-icon {
            margin-top: 0 !important;
        }
    }
</style>

<script>
(function () {
    function initAccordion() {
        var lists = document.querySelectorAll('[data-accordion-list]');
        if (!lists || lists.length === 0) return;
        lists.forEach(function (list) {
        var items = Array.prototype.slice.call(
            list.querySelectorAll('.faq-acc-root')
        );
        items.forEach(function (item) {
            var contentWrapper = item.querySelector('.faq-acc-content-wrapper');
            contentWrapper.style.overflow = "hidden";
            contentWrapper.style.transition = "max-height 0.45s ease, opacity 0.35s ease";
            if (item.open) {
                contentWrapper.style.maxHeight = contentWrapper.scrollHeight + "px";
                contentWrapper.style.opacity = "1";
                item.classList.add('is-open');
                requestAnimationFrame(function () {
                    setTimeout(function () {
                        if (item.open) contentWrapper.style.maxHeight = '';
                    }, 50);
                });
            } else {
                contentWrapper.style.maxHeight = "0px";
                contentWrapper.style.opacity = "0";
                item.classList.remove('is-open');
            }
            function smoothClose() {
                var startHeight = contentWrapper.scrollHeight;
                contentWrapper.style.maxHeight = startHeight + 'px';
                contentWrapper.offsetHeight;
                try { item.classList.remove('is-open'); } catch (e) {}
                requestAnimationFrame(function () {
                    contentWrapper.style.maxHeight = '0px';
                    contentWrapper.style.opacity = '0';
                });
            }
            function smoothOpen() {
                contentWrapper.style.maxHeight = '0px';
                contentWrapper.style.opacity = '0';
                var full = contentWrapper.scrollHeight;
                try { item.classList.add('is-open'); } catch (e) {}
                requestAnimationFrame(function () {
                    contentWrapper.style.maxHeight = full + 'px';
                    contentWrapper.style.opacity = '1';
                });
            }
            item._animating = false;
            function smoothClose() {
                if (item._animating) return;
                item._animating = true;
                var startHeight = contentWrapper.scrollHeight;
                contentWrapper.style.maxHeight = startHeight + 'px';
                // force reflow
                contentWrapper.offsetHeight;
                try { item.classList.remove('is-open'); } catch (e) {}
                requestAnimationFrame(function () {
                    contentWrapper.style.maxHeight = '0px';
                    contentWrapper.style.opacity = '0';
                });
                var finished = false;
                var finishClose = function (ev) {
                    if (finished) return;
                    finished = true;
                    contentWrapper.removeEventListener('transitionend', finishClose);
                    try { item.open = false; } catch (e) {}
                    item._animating = false;
                    contentWrapper.style.maxHeight = '0px';
                    clearTimeout(fallback);
                };
                contentWrapper.addEventListener('transitionend', finishClose);
                var fallback = setTimeout(function () { finishClose(); }, 600);
            }
            function smoothOpen() {
                if (item._animating) return;
                item._animating = true;
                try { item.open = true; } catch (e) {}
                contentWrapper.style.maxHeight = '0px';
                contentWrapper.style.opacity = '0';
                try { item.classList.add('is-open'); } catch (e) {}
                requestAnimationFrame(function () {
                    var full = contentWrapper.scrollHeight;
                    contentWrapper.style.maxHeight = full + 'px';
                    contentWrapper.style.opacity = '1';
                });

                var finished = false;
                var finishOpen = function (ev) {
                    if (finished) return;
                    finished = true;
                    contentWrapper.removeEventListener('transitionend', finishOpen);
                    contentWrapper.style.maxHeight = '';
                    item._animating = false;
                    clearTimeout(fallback);
                };
                contentWrapper.addEventListener('transitionend', finishOpen);
                var fallback = setTimeout(function () { finishOpen(); }, 600);
            }

            var summary = item.querySelector('summary');
            if (summary) {
                summary.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (item._animating) return;
                    if (item.open) smoothClose(); else smoothOpen();
                });
            }
            item.addEventListener('toggle', function () {
                if (item._animating) return;
                if (item.open) smoothOpen(); else smoothClose();
            });
        });
        });
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initAccordion);
    } else {
        initAccordion();
    }
})();
</script>