<header class="bg-[#020303] h-[60px] md:h-[72px] lg:h-[82px] flex justify-center mx-auto " role="banner">
  <style>
    header {
      position: relative;
      top: 0;
      z-index: 1000;
    }

    .nav-link {
      position: relative;
      display: inline-block;
    }

    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -11px;
      left: 50%;
      transform: translateX(-50%);
      width: 58px;
      height: 2px;
      background-color: #ba0108;
    }

    /* Mobile menu styles */
    .mobile-menu {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
      display: none;
    }

    .mobile-menu.open {
      transform: translateX(0);
    }

    /* Hamburger animation */
    .hamburger span {
      transition: all 0.3s ease;
    }

    .hamburger.open span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger.open span:nth-child(2) {
      opacity: 0;
    }

    .hamburger.open span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    /* Dropdown menu positioning */
    .dropdown-menu {
      width: 237px;
      z-index: 1000;
      display: none;
      transition: all 0.3s ease-in-out;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
    }

    .dropdown-parent:hover .dropdown-menu,
    .dropdown-menu:hover,
    .dropdown-parent.active .dropdown-menu {
      display: block;
    }

    /* Add gap between parent and dropdown to prevent flickering */
    .dropdown-parent::before {
      content: '';
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      height: 12px;
      z-index: 999;
    }

    /* Dropdown item styling */
    .dropdown-item {
      position: relative;
      cursor: pointer;
      display: block;
      text-align: center;
    }

    .dropdown-item:hover {
      background-color: rgba(186, 1, 8, 0.1);
    }

    .dropdown-item:not(:last-child)::after {
      content: '';
      position: absolute;
      right: 0;
      top: 20%;
      height: 60%;
      width: 2px;
      background-color: #ba0108;
    }

    @media (min-width: 1024px) {
      .dropdown-item:not(:last-child)::after {
        right: auto;
        top: auto;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        height: 2px;
        width: 58px;
        background-color: #ba0108;
      }
    }

    /* Responsive breakpoints */
    @media (max-width: 809px) {
      .desktop-nav {
        display: none !important;
      }

      .mobile-nav {
        display: flex !important;
        min-height: 60px;
      }

      .mobile-menu {
        display: flex !important;
      }
    }

    @media (min-width: 810px) {
      .mobile-nav {
        display: none !important;
      }

      .mobile-menu {
        display: none !important;
      }

      .desktop-nav {
        display: flex !important;
      }
    }

    /* Tablet specific adjustments */
    @media (max-width: 1024px) and (min-width: 769px) {
      .nav-container {
        gap: 10px;
      }

      .nav-link {
        font-size: 16px;
      }

      .dropdown-menu {
        min-width: 506px;
      }

      .dropdown-item {
        padding: 12px 16px;
        font-size: 14px;
      }

      .contact-phone {
        display: none;
      }

      .language-switcher {
        gap: 8px;
        font-size: 16px;
      }
    }

    @media (max-width: 900px) and (min-width: 769px) {
      .nav-link {
        font-size: 14px;
      }

      .nav-container {
        gap: 8px;
      }
    }

    @media (min-width: 768px) and (max-width: 1023px) {
      .nav-container {
        padding-top: 15px !important;
        padding-bottom: 15px !important;
      }
    }

    @media (min-width: 1024px) {
      .nav-container {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
      }
    }
  </style>

  <!-- Responsive container with breakpoint-specific widths -->
  <div class="flex w-full max-w-[1280px] px-[20px] justify-between items-center nav-container"
    style="padding-top: 20px; padding-bottom: 20px;">
    <!-- Logo -->
    <a href="/" class="relative z-[10] text-xl font-normal text-white font-inter" aria-label="Karma - головна сторінка">
      {{ $logo := resources.Get "logo.png" }}
      {{ if $logo }}
      {{ $logo1x := $logo.Resize "149x34 webp q80" }}
      {{ $logo2x := $logo.Resize "298x68 webp q80" }}
      <img src="{{ $logo1x.RelPermalink }}" srcset="{{ $logo1x.RelPermalink }} 1x, {{ $logo2x.RelPermalink }} 2x"
        width="149" height="34" alt="logo" />
      {{ else }}
      <img src="/logo.png" alt="logo" width="149" height="34" class="w-[108px] h-[25px] md:w-[149px] md:h-[34px]" />
      {{ end }}
    </a>

    <!-- Desktop Navigation -->
    <nav class="nav-container desktop-nav flex items-center gap-[50px]" role="navigation" aria-label="Головне меню">
      <div class="relative dropdown-parent">
        <button onclick="toggleDropdown(event)"
          class="nav-link lg:font-['Inter'] max-[450px]:font-['Unbounded'] text-xl focus:font-bold text-white hover:text-[#ba0108] transition-colors {{ if or (eq .Page.Section "catalog") (hasPrefix .Page.RelPermalink "/catalog/" ) }}active{{ end }}" aria-expanded="false"
          aria-haspopup="true" aria-label="Каталог товарів">
          Каталог
        </button>
        <div class="dropdown-menu absolute left-[-50px] lg:left-[-80px] top-[30px] mt-3 bg-[#020303] rounded-b-[5px]"
          role="menu" aria-label="Підменю каталогу">
          <div class="flex flex-row w-full lg:flex-col">
            <a href="/catalog/politni-steky/"
              class="dropdown-item flex-1 px-8 py-6 text-white lg:font-['Inter'] max-[450px]:font-['Unbounded'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap"
              role="menuitem">Політні
              стеки</a>
            <a href="/catalog/videoperedavachi-vtx/"
              class="dropdown-item flex-1 px-8 py-6 text-white lg:font-['Inter'] max-[450px]:font-['Unbounded'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap"
              role="menuitem">Відеопередавачі
              VTX</a>
            <a href="/catalog/esc/"
              class="dropdown-item flex-1 px-8 py-6 text-white lg:font-['Inter'] max-[450px]:font-['Unbounded'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap"
              role="menuitem">ESC</a>
          </div>
        </div>
      </div>
      <a href="/faq"
        class="nav-link lg:font-['Inter'] max-[450px]:font-['Unbounded'] text-xl font-normal text-white hover:text-[#ba0108] transition-colors {{ if eq .Page.Section "faq" }}active{{ end }}">
        FAQ
      </a>
      <a href="/knowledge-base"
        class="nav-link lg:font-['Inter'] max-[450px]:font-['Unbounded'] text-xl font-normal text-white hover:text-[#ba0108] transition-colors {{ if eq .Page.Section "knowledge-base" }}active{{ end }}">
        База знань
      </a>
      <a href="/contact"
        class="nav-link lg:font-['Inter'] max-[450px]:font-['Unbounded'] text-xl font-normal text-white hover:text-[#ba0108] transition-colors {{ if eq .Page.Section "contact" }}active{{ end }}">
        Контакти
      </a>
    </nav>

    <!-- Desktop Contact & Language -->
    <div class="desktop-nav flex gap-[50px] justify-center items-center">
      <nav class="flex items-center gap-[30px]">
        <a href="tel:(067) 298-29-29"
          class=" font-['Montserrat'] text-xl font-normal text-white hover:text-[#ba0108] transition-colors hidden lg:block"
          aria-label="Зателефонувати за номером (067) 298-29-29">
          (067) 298-29-29
        </a>
        <div class="flex gap-3 items-center text-xl language-switcher text-white/80">
          <button id="lang-ua"
            class="font-['Inter'] font-bold cursor-pointer text-[#ba0108] hover:text-[#ba0108] focus:text-[#ba0108] focus:font-bold transition-colors"
            onclick="switchLanguage('ua')" aria-label="Перемкнути на українську мову" aria-pressed="true">UA</button>
          <span aria-hidden="true">|</span>
          <button id="lang-en"
            class="font-['Inter'] font-[300] cursor-pointer text-white/80 hover:text-[#ba0108] focus:text-[#ba0108] transition-colors"
            onclick="switchLanguage('en')" aria-label="Switch to English" aria-pressed="false">EN</button>
        </div>
      </nav>
    </div>

    <!-- Mobile Navigation -->
    <div class="flex gap-4 items-center mobile-nav">
      <!-- Search Icon -->
      <button class="text-white hover:text-[#ba0108] transition-colors cursor-pointer" onclick="toggleMobileSearch()"
        aria-label="Відкрити пошук">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true">
          <path
            d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>

      <!-- Hamburger Menu Button -->
      <button class="flex flex-col justify-center items-center space-y-1 w-8 h-8 cursor-pointer hamburger"
        onclick="toggleMobileMenu()" aria-label="Відкрити мобільне меню" aria-expanded="false">
        <span class="block w-6 h-0.5 bg-white" aria-hidden="true"></span>
        <span class="block w-6 h-0.5 bg-white" aria-hidden="true"></span>
        <span class="block w-6 h-0.5 bg-white" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Search Overlay -->
  <div id="mobile-search-overlay" class="hidden fixed inset-0 z-50 mobile-search-overlay bg-black/80">
    <div class="bg-[#020303] p-6 rounded-b-3xl">
      <div class="flex justify-between items-center mb-4">
        <a href="/" class="text-xl font-normal text-white font-inter">
          {{ $logoMobile := resources.Get "logo.png" }}
          {{ if $logoMobile }}
          {{ $logoMobile1x := $logoMobile.Resize "108x25 webp q80" }}
          {{ $logoMobile2x := $logoMobile.Resize "216x50 webp q80" }}
          <img src="{{ $logoMobile1x.RelPermalink }}"
            srcset="{{ $logoMobile1x.RelPermalink }} 1x, {{ $logoMobile2x.RelPermalink }} 2x" width="108" height="25"
            alt="logo" />
          {{ else }}
          <img src="/logo.png" alt="logo" width="108" height="25" />
          {{ end }}
        </a>
        <button class="text-white hover:text-[#ba0108] transition-colors cursor-pointer" onclick="toggleMobileSearch()"
          aria-label="Закрити пошук">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </button>
      </div>

      <div class="relative">
        <input type="text" placeholder="Пошук по сайту"
          class="w-full h-[60px] rounded-full font-['Montserrat'] border-0 pl-6 pr-[140px] text-lg outline-none bg-white text-black placeholder-gray-500"
          id="mobile-search-input" aria-label="Поле для пошуку" />
        <button
          class="absolute right-0 top-0 h-[60px] w-[120px] rounded-full bg-[#ba0108] flex items-center justify-center cursor-pointer hover:bg-[#a00007] transition-colors"
          aria-label="Почати пошук">
          <span class="text-white font-['Montserrat'] text-lg font-medium">Пошук</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div id="mobileMenu" class="mobile-menu fixed inset-0 bg-[#020303] z-40 flex flex-col" role="dialog" aria-modal="true"
    aria-label="Мобільне меню">
    <!-- Fixed Header with Logo and Close Button -->
    <div
      class="flex relative z-[12] justify-between items-center p-4 shadow-[0_2px_8px_rgba(255,255,255,0.4)] bg-[#020303]">
      <!-- Logo -->
      <a href="/" class="text-xl font-normal text-white font-inter" aria-label="Karma - головна сторінка">
        {{ $logoMobile := resources.Get "logo.png" }}
        {{ if $logoMobile }}
        {{ $logoMobile1x := $logoMobile.Resize "108x25 webp q80" }}
        {{ $logoMobile2x := $logoMobile.Resize "216x50 webp q80" }}
        <img src="{{ $logoMobile1x.RelPermalink }}"
          srcset="{{ $logoMobile1x.RelPermalink }} 1x, {{ $logoMobile2x.RelPermalink }} 2x" width="108" height="25"
          alt="logo" />
        {{ else }}
        <img src="/logo.png" alt="logo" width="108" height="25" />
        {{ end }}
      </a>

      <!-- Close Button -->
      <button class="flex relative flex-col justify-center items-center w-12 h-12 cursor-pointer hamburger"
        onclick="toggleMobileMenu()" aria-label="Закрити мобільне меню">
        <span class="block absolute w-6 h-0.5 bg-white rotate-45" aria-hidden="true"></span>
        <span class="block absolute w-6 h-0.5 bg-white -rotate-45" aria-hidden="true"></span>
      </button>
    </div>

    <nav class="flex flex-col flex-1 items-center px-6 pt-[119px] space-y-6" role="navigation"
      aria-label="Мобільне меню">
      <div class="relative">
        <button onclick="toggleMobileCatalog()"
          class="w-full flex justify-center items-center text-white font-['Unbounded'] text-xl font-normal py-2 cursor-pointer"
          aria-expanded="false" aria-controls="mobile-catalog-submenu" aria-label="Каталог товарів">
          <span class="font-['Unbounded'] text-xl font-normal text-white">Каталог</span>
          <svg class="w-5 h-5 transition-transform transform mobile-catalog-arrow" fill="none" stroke="currentColor"
            viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div class="overflow-hidden max-h-0 opacity-0 transition-all duration-300 ease-in-out mobile-catalog-menu"
          id="mobile-catalog-submenu">
          <div class="flex flex-col items-center pl-4 mt-2 space-y-2">
            <a href="/catalog/politni-steky/"
              class="block text-white/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">Політні
              стеки</a>
            <a href="/catalog/videoperedavachi-vtx/"
              class="block text-white/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">Відеопередавачі
              VTX</a>
            <a href="/catalog/esc/"
              class="block text-white/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">ESC</a>
          </div>
        </div>
      </div>
      <a href="/faq"
        class="text-white font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">FAQ</a>
      <a href="/knowledge-base"
        class="text-white font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">База знань</a>
      <a href="/contact"
        class="text-white font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">Контакти</a>

      <div class="flex absolute bottom-10 flex-col items-center">
        <a href="tel:(067) 298-29-29"
          class="block text-white font-['Montserrat'] text-xl font-normal mb-4 hover:text-[#ba0108] transition-colors">(067)
          298-29-29</a>
        <div class="flex gap-3 items-center text-2xl text-white">
          <button id="mobile-lang-ua"
            class="!font-[Unbounded] font-[300] cursor-pointer text-[#ba0108] hover:text-[#ba0108] focus:text-[#ba0108] transition-colors"
            onclick="switchLanguage('ua')" aria-label="Перемкнути на українську мову" aria-pressed="true">
            UA
          </button>
          <span aria-hidden="true">|</span>
          <button id="mobile-lang-en"
            class="!font-[Unbounded] font-[300] cursor-pointer text-white/80 hover:text-[#ba0108] focus:text-[#ba0108] transition-colors"
            onclick="switchLanguage('en')" aria-label="Switch to English" aria-pressed="false">
            EN
          </button>
        </div>
      </div>
    </nav>
  </div>

  <script>
    function toggleMobileMenu() {
      const mobileMenu = document.getElementById('mobileMenu');
      const hamburger = document.querySelector('.hamburger');
      const isOpen = mobileMenu.classList.contains('open');

      mobileMenu.classList.toggle('open');
      hamburger.classList.toggle('open');

      // Update ARIA attributes
      hamburger.setAttribute('aria-expanded', !isOpen);

      // Manage focus and body scroll
      if (!isOpen) {
        document.body.style.overflow = 'hidden';
        // Focus first focusable element in menu
        setTimeout(() => {
          const firstFocusable = mobileMenu.querySelector('button, a');
          if (firstFocusable) firstFocusable.focus();
        }, 100);
      } else {
        document.body.style.overflow = '';
        hamburger.focus();
      }
    }

    function toggleDropdown(event) {
      event.preventDefault();
      const dropdownParent = event.target.closest('.dropdown-parent');
      const button = event.target;
      const isOpen = dropdownParent.classList.contains('active');

      dropdownParent.classList.toggle('active');
      button.setAttribute('aria-expanded', !isOpen);
    }

    function toggleMobileCatalog() {
      const catalogMenu = document.querySelector('.mobile-catalog-menu');
      const arrow = document.querySelector('.mobile-catalog-arrow');
      const button = document.querySelector('[aria-controls="mobile-catalog-submenu"]');
      const isOpen = !catalogMenu.classList.contains('max-h-0');

      if (catalogMenu.classList.contains('max-h-0')) {
        catalogMenu.classList.remove('max-h-0', 'opacity-0');
        catalogMenu.classList.add('max-h-96', 'opacity-100');
        arrow.classList.add('rotate-180');
        button.setAttribute('aria-expanded', 'true');
      } else {
        catalogMenu.classList.add('max-h-0', 'opacity-0');
        catalogMenu.classList.remove('max-h-96', 'opacity-100');
        arrow.classList.remove('rotate-180');
        button.setAttribute('aria-expanded', 'false');
      }
    }

    function toggleMobileSearch() {
      const searchOverlay = document.getElementById('mobile-search-overlay');
      const body = document.body;

      if (searchOverlay.classList.contains('hidden')) {
        searchOverlay.classList.remove('hidden');
        body.style.overflow = 'hidden';
        // Focus on search input after animation
        setTimeout(() => {
          document.getElementById('mobile-search-input').focus();
        }, 100);
      } else {
        searchOverlay.classList.add('hidden');
        body.style.overflow = '';
      }
    }

    function switchLanguage(lang) {
      const uaDesktop = document.getElementById('lang-ua');
      const enDesktop = document.getElementById('lang-en');
      const uaMobile = document.getElementById('mobile-lang-ua');
      const enMobile = document.getElementById('mobile-lang-en');

      if (lang === 'ua') {
        // Set UA as active (red)
        uaDesktop.className = "font-['Inter'] font-bold cursor-pointer text-[#ba0108] hover:text-[#ba0108] focus:text-[#ba0108] focus:font-bold transition-colors";
        enDesktop.className = "font-['Inter'] font-[300] cursor-pointer text-white/80 hover:text-[#ba0108] focus:text-[#ba0108] transition-colors";
        uaMobile.className = "!font-[Unbounded] font-[300] cursor-pointer text-[#ba0108] hover:text-[#ba0108] focus:text-[#ba0108] transition-colors";
        enMobile.className = "!font-[Unbounded] font-[300] cursor-pointer text-white/80 hover:text-[#ba0108] focus:text-[#ba0108] transition-colors";

        // Update ARIA pressed states
        uaDesktop.setAttribute('aria-pressed', 'true');
        enDesktop.setAttribute('aria-pressed', 'false');
        uaMobile.setAttribute('aria-pressed', 'true');
        enMobile.setAttribute('aria-pressed', 'false');
      } else if (lang === 'en') {
        // Set EN as active (red)
        uaDesktop.className = "font-['Inter'] font-[300] cursor-pointer text-white/80 hover:text-[#ba0108] focus:text-[#ba0108] transition-colors";
        enDesktop.className = "font-['Inter'] font-bold cursor-pointer text-[#ba0108] hover:text-[#ba0108] focus:text-[#ba0108] focus:font-bold transition-colors";
        uaMobile.className = "!font-[Unbounded] font-[300] cursor-pointer text-white/80 hover:text-[#ba0108] focus:text-[#ba0108] transition-colors";
        enMobile.className = "!font-[Unbounded] font-[300] cursor-pointer text-[#ba0108] hover:text-[#ba0108] focus:text-[#ba0108] transition-colors";

        // Update ARIA pressed states
        uaDesktop.setAttribute('aria-pressed', 'false');
        enDesktop.setAttribute('aria-pressed', 'true');
        uaMobile.setAttribute('aria-pressed', 'false');
        enMobile.setAttribute('aria-pressed', 'true');
      }

      // Store the selected language in localStorage
      localStorage.setItem('selectedLanguage', lang);

      // Here you can add actual language switching logic
      // For example, reload the page with a different language parameter
      // window.location.href = window.location.pathname + '?lang=' + lang;
    }

    // Initialize language on page load
    document.addEventListener('DOMContentLoaded', function () {
      const savedLang = localStorage.getItem('selectedLanguage') || 'ua';
      switchLanguage(savedLang);
    });

    // Close mobile menu when clicking on a link
    document.querySelectorAll('#mobileMenu a').forEach(link => {
      link.addEventListener('click', () => {
        toggleMobileMenu();
      });
    });

    // Close mobile menu and dropdown when clicking outside
    document.addEventListener('click', (e) => {
      const mobileMenu = document.getElementById('mobileMenu');
      const hamburger = document.querySelector('.hamburger');
      const dropdownParent = document.querySelector('.dropdown-parent');

      // Close mobile menu
      if (!hamburger.contains(e.target) && !mobileMenu.contains(e.target)) {
        mobileMenu.classList.remove('open');
        hamburger.classList.remove('open');
      }

      // Close dropdown menu
      if (!dropdownParent.contains(e.target)) {
        dropdownParent.classList.remove('active');
      }
    });

    // Keep dropdown open when hovering over it
    document.addEventListener('DOMContentLoaded', () => {
      const dropdownParent = document.querySelector('.dropdown-parent');
      const dropdownMenu = document.querySelector('.dropdown-menu');

      let hoverTimeout;

      dropdownParent.addEventListener('mouseenter', () => {
        clearTimeout(hoverTimeout);
        dropdownParent.classList.add('active');
      });

      dropdownParent.addEventListener('mouseleave', () => {
        hoverTimeout = setTimeout(() => {
          dropdownParent.classList.remove('active');
        }, 300); 
      });

      dropdownMenu.addEventListener('mouseenter', () => {
        clearTimeout(hoverTimeout);
      });

      dropdownMenu.addEventListener('mouseleave', () => {
        hoverTimeout = setTimeout(() => {
          dropdownParent.classList.remove('active');
        }, 300);
      });
    });
  </script>
</header>