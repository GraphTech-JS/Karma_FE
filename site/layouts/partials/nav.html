<header class="bg-[#020303] flex justify-center" role="banner">
  <!-- Responsive container -->
  <div class="flex w-full max-w-[1280px] px-[20px] justify-between items-center nav-container py-0 md:py-5">
    <!-- Logo -->
    <a href="{{ .Site.Home.RelPermalink }}" class="relative z-[10]" aria-label="{{ i18n " aria.logo.alt" }}">
      <img src="/logo.png" alt="{{ i18n " aria.logo.alt" }}" width="149" height="34"
        class="w-[108px] h-[25px] md:w-[149px] md:h-[34px]" />
    </a>

    <!-- Desktop Navigation -->
    <nav class="nav-container desktop-nav hidden items-center gap-[50px]" role="navigation" aria-label="{{ i18n "aria.nav.main" }}">
      <!-- Каталог -->
      <div class="relative dropdown-parent">
        {{ $catalogBase := "catalog/" | relLangURL }}
        <button
          class="nav-link lg:!font-['Inter'] cursor-pointer font-normal text-xl text-[#fefefe] hover:text-[#ba0108] transition-colors {{ if hasPrefix .RelPermalink $catalogBase }}active{{ end }}"
          aria-expanded="false" aria-haspopup="true" aria-label="{{ i18n " aria.catalog.toggle" }}">
          {{ i18n "nav.catalog" }}
        </button>
        <div class="dropdown-menu absolute left-[-50px] lg:left-[-80px] top-[30px] mt-3 bg-[#020303] rounded-b-[5px]"
          role="menu" aria-label="{{ i18n " aria.catalog.submenu" }}">
          <div class="flex flex-row w-full lg:flex-col">
            {{ $stacksURL := "catalog/politni-steky/" | relLangURL }}
            {{ $vtxURL := "catalog/videoperedavachi-vtx/" | relLangURL }}
            {{ $escURL := "catalog/esc/" | relLangURL }}

            <a href="{{ $stacksURL }}"
              class="dropdown-item flex-1 px-8 py-6 text-[#fefefe] lg:font-['Inter'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap {{ if eq .RelPermalink $stacksURL }}active{{ end }}"
              role="menuitem">{{ i18n "catalog.stacks" }}</a>

            <a href="{{ $vtxURL }}"
              class="dropdown-item flex-1 px-8 py-6 text-[#fefefe] lg:font-['Inter'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap {{ if eq .RelPermalink $vtxURL }}active{{ end }}"
              role="menuitem">{{ i18n "catalog.vtx" }}</a>

            <a href="{{ $escURL }}"
              class="dropdown-item flex-1 px-8 py-6 text-[#fefefe] lg:font-['Inter'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap {{ if eq .RelPermalink $escURL }}active{{ end }}"
              role="menuitem">{{ i18n "catalog.esc" }}</a>
          </div>
        </div>
      </div>

      <!-- FAQ -->
      {{ $faqBase := "faq/" | relLangURL }}
      <a href="{{ $faqBase }}"
        class="nav-link lg:font-['Inter'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors {{ if hasPrefix .RelPermalink $faqBase }}active{{ end }}">{{i18n "nav.faq" }}</a>

      <!-- Knowledge Base -->
      {{ $kbBase := "knowledge-base/" | relLangURL }}
      <a href="{{ $kbBase }}"
        class="nav-link lg:font-['Inter'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors {{ if hasPrefix .RelPermalink $kbBase }}active{{ end }}">{{i18n "nav.knowledge" }}</a>

      <!-- Contact -->
      {{ $contactBase := "contact/" | relLangURL }}
      <a href="{{ $contactBase }}"
        class="nav-link lg:font-['Inter'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors {{ if hasPrefix .RelPermalink $contactBase }}active{{ end }}">{{i18n "nav.contacts" }}</a>
    </nav>

    <!-- Desktop contacts/lang -->
    <nav class="desktop-nav hidden items-baseline justify-center gap-[30px]">
      <a href="tel:+380 63 202 57 77"
        class="flex items-center font-['Montserrat'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors hidden lg:block"
        aria-label="{{ i18n " aria.phone.alt" }}">
        +380 63 202 57 77
      </a>

      <!-- Language switcher (always show all langs; fallback to Home if translation missing) -->
      <div id="language-switcher-container"
        class="flex gap-3 items-center justify-center text-xl language-switcher text-[#fefefe]">
        {{ $page := . }}
        {{ $currentLang := $page.Site.Language.Lang }}
        {{ $langs := site.Languages }}
        {{ $trans := $page.AllTranslations }}
        {{ $currRel := $page.RelPermalink }}
        {{ $currHome := $page.Site.Home.RelPermalink }}

        {{ range $i, $l := $langs }}
        {{ $isCurrent := eq $l.Lang $currentLang }}
        {{ $tr := first 1 (where $trans "Lang" $l.Lang) }}
        {{ $url := "" }}

        {{ if gt (len $tr) 0 }}
        {{ $url = (index $tr 0).RelPermalink }}
        {{ else }}
        {{ $targetSite := first 1 (where site.Sites "Language.Lang" $l.Lang) }}
        {{ $targetHome := "" }}
        {{ if gt (len $targetSite) 0 }}
        {{ $targetHome = (index $targetSite 0).Home.RelPermalink }}
        {{ end }}

        {{ $suffix := strings.TrimPrefix $currRel $currHome }}

        {{ $altCurr := printf "/%s/" $currentLang }}
        {{ if hasPrefix $suffix $altCurr }}
        {{ $suffix = strings.TrimPrefix $suffix $altCurr }}
        {{ end }}

        {{ $url = printf "%s%s" $targetHome $suffix }}
        {{ end }}

        <a href="{{ $url }}" lang="{{ $l.Lang }}" hreflang="{{ $l.Lang }}"
          class="font-['Montserrat'] text-xl font-normal cursor-pointer hover:text-[#ba0108] transition-colors{{ if $isCurrent }} !text-[#ba0108] !font-bold font-['Inter']{{ else }} text-[#fefefe]{{ end }}">
          {{ if eq $l.Lang "uk" }}UA{{ else }}{{ upper $l.Lang }}{{ end }}
        </a>
        {{ if lt (add $i 1) (len $langs) }}
        <div class="w-px h-6 bg-white/50" aria-hidden="true"></div>
        {{ end }}
        {{ end }}
      </div>
    </nav>

    <!-- Mobile Navigation -->
    <div class="flex gap-4 items-center mobile-nav">
      <button id="search-toggle-button" class="text-[#fefefe] hover:text-[#ba0108] transition-colors"
        aria-label="{{ i18n " aria.search.toggle" }}" aria-haspopup="true" aria-expanded="false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true">
          <path
            d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
      <button class="flex flex-col justify-center items-center space-y-1 w-8 h-8 hamburger" onclick="toggleMobileMenu()"
        aria-label="{{ i18n " aria.menu.toggle" }}" aria-expanded="false">
        <span class="block w-6 h-0.5 bg-white"></span>
        <span class="block w-6 h-0.5 bg-white"></span>
        <span class="block w-6 h-0.5 bg-white"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Search Panel -->
  <div id="mobile-search-panel" class="py-[13px] px-[24px]" role="search">
    <div class="relative">
      <input type="text" placeholder="{{ i18n "search.placeholder" }}"
        class="w-full h-[41px] rounded-full font-['Montserrat'] border-0 pl-6 pr-[110px] text-lg outline-none bg-white text-black placeholder-gray-500"
        id="mobile-search-input" aria-label="{{ i18n " aria.search.field" }}" autocomplete="off" />
      <button
        class="absolute right-0 top-0 h-[41px] w-[100px] rounded-full bg-[#ba0108] flex items-center justify-center hover:bg-[#a00007]"
        aria-label="{{ i18n " aria.search.button" }}" id="mobile-search-button">
        <span class="text-[#fefefe] font-['Montserrat'] text-[13px]">{{ i18n "search.start" }}</span>
      </button>
    </div>
    <div id="mobile-search-results" class="max-h-[60vh] overflow-y-auto mt-2"></div>
  </div>

 

  <!-- Mobile Menu Overlay -->
  <div id="mobileMenu" class="mobile-menu fixed inset-0 bg-[#020303] z-40 flex flex-col" role="dialog" aria-modal="true"
    aria-label="{{ i18n " aria.menu.dialog" }}">
    <div
      class="flex relative z-[12] justify-between items-center p-4 shadow-[0_2px_8px_rgba(255,255,255,0.4)] bg-[#020303]">
      <a href="{{ .Site.Home.RelPermalink }}" class="text-xl font-normal text-[#fefefe] font-inter"
        aria-label="{{ i18n " aria.logo.alt" }}">
        <img src="/logo.png" alt="{{ i18n " aria.logo.alt" }}" width="108" height="25">
      </a>
      <button class="flex relative flex-col justify-center items-center w-12 h-12 cursor-pointer hamburger"
        onclick="toggleMobileMenu()" aria-label="{{ i18n " aria.menu.close" }}">
        <span class="block absolute w-6 h-0.5 bg-white rotate-45" aria-hidden="true"></span>
        <span class="block absolute w-6 h-0.5 bg-white -rotate-45" aria-hidden="true"></span>
      </button>
    </div>

    <nav class="flex flex-col flex-1 items-center px-6 pt-[119px] space-y-6" role="navigation" aria-label="{{ i18n "aria.nav.mobile" }}">
      <!-- Navigation links in the center -->
      <div class="flex flex-col items-center space-y-6">
        <div class="relative">
          <button onclick="toggleMobileCatalog()"
            class="w-full flex justify-center items-center text-[#fefefe] font-['Unbounded'] text-xl font-normal py-2 cursor-pointer"
            aria-expanded="false" aria-controls="mobile-catalog-submenu" aria-label="{{ i18n "aria.catalog.mobile.toggle"}}">
            <span class="font-['Unbounded'] text-xl font-normal text-[#fefefe]">{{ i18n "nav.catalog" }}</span>
            <svg class="w-5 h-5 transition-transform transform mobile-catalog-arrow" fill="none" stroke="currentColor"
              viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="overflow-hidden max-h-0 opacity-0 transition-all duration-300 ease-in-out mobile-catalog-menu"
            id="mobile-catalog-submenu">
            <div class="flex flex-col items-center pl-4 mt-2 space-y-2">
              {{ $stacksURL := "catalog/politni-steky/" | relLangURL }}
              {{ $vtxURL := "catalog/videoperedavachi-vtx/" | relLangURL }}
              {{ $escURL := "catalog/esc/" | relLangURL }}

              <a href="{{ $stacksURL }}"
                class="block text-[#fefefe]/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">{{i18n
                "catalog.stacks" }}</a>
              <a href="{{ $vtxURL }}"
                class="block text-[#fefefe]/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">{{i18n
                "catalog.vtx" }}</a>
              <a href="{{ $escURL }}"
                class="block text-[#fefefe]/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">{{i18n
                "catalog.esc" }}</a>
            </div>
          </div>
        </div>

        {{ $faqBase := "faq/" | relLangURL }}
        <a href="{{ $faqBase }}"
          class="text-[#fefefe] font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">{{i18n "nav.faq" }}</a>

        {{ $kbBase := "knowledge-base/" | relLangURL }}
        <a href="{{ $kbBase }}"
          class="text-[#fefefe] font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">{{i18n "nav.knowledge" }}</a>

        {{ $contactBase := "contact/" | relLangURL }}
        <a href="{{ $contactBase }}"
          class="text-[#fefefe] font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">{{i18n "nav.contacts" }}</a>
      </div>

      <!-- Phone and language switcher at the bottom -->
      <div class="flex flex-col items-center pb-8 mt-auto space-y-4">
        <!-- Mobile phone number -->
        <a href="tel:+380 63 202 57 77" class="text-[#fefefe] font-['Montserrat'] text-[20px] font-[400]">
          +380 63 202 57 77
        </a>

        <!-- Mobile language switcher -->
        <div class="flex gap-3 items-center text-2xl text-[#fefefe]">
          {{ $page := . }}
          {{ $currentLang := $page.Site.Language.Lang }}
          {{ $langs := site.Languages }}
          {{ $trans := $page.AllTranslations }}
          {{ $currRel := $page.RelPermalink }}
          {{ $currHome := $page.Site.Home.RelPermalink }}

          {{ range $i, $l := $langs }}
          {{ $isCurrent := eq $l.Lang $currentLang }}
          {{ $tr := first 1 (where $trans "Lang" $l.Lang) }}
          {{ $url := "" }}

          {{ if gt (len $tr) 0 }}
          {{ $url = (index $tr 0).RelPermalink }}
          {{ else }}
          {{ $targetSite := first 1 (where site.Sites "Language.Lang" $l.Lang) }}
          {{ $targetHome := "" }}
          {{ if gt (len $targetSite) 0 }}
          {{ $targetHome = (index $targetSite 0).Home.RelPermalink }}
          {{ end }}

          {{ $suffix := strings.TrimPrefix $currRel $currHome }}

          {{ $altCurr := printf "/%s/" $currentLang }}
          {{ if hasPrefix $suffix $altCurr }}
          {{ $suffix = strings.TrimPrefix $suffix $altCurr }}
          {{ end }}

          {{ $url = printf "%s%s" $targetHome $suffix }}
          {{ end }}

          <a href="{{ $url }}" lang="{{ $l.Lang }}" hreflang="{{ $l.Lang }}"
            class="font-['Montserrat'] text-xl font-normal cursor-pointer hover:text-[#ba0108] transition-colors{{ if $isCurrent }} !text-[#ba0108] !font-bold font-['Inter']{{ else }} text-[#fefefe]{{ end }}">
            {{ if eq $l.Lang "uk" }}UA{{ else }}{{ upper $l.Lang }}{{ end }}
          </a>
          {{ if lt (add $i 1) (len $langs) }}
          <div class="w-px h-6 bg-white/50" aria-hidden="true"></div>
          {{ end }}
          {{ end }}
        </div>
      </div>
    </nav>
  </div>
</header>