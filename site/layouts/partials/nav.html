<header class="bg-[#020303] h-[60px] md:h-[72px] lg:h-[82px] flex justify-center" role="banner">
  <style>
    header {
      position: relative;
      top: 0;
      z-index: 1000;
    }

    .nav-link {
      position: relative;
      display: inline-block;
    }

    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -11px;
      left: 50%;
      transform: translateX(-50%);
      width: 58px;
      height: 2px;
      background-color: #ba0108;
    }

    .mobile-menu {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
      display: none;
    }

    .mobile-menu.open {
      transform: translateX(0);
    }

    .hamburger span {
      transition: all 0.3s ease;
    }

    .hamburger.open span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger.open span:nth-child(2) {
      opacity: 0;
    }

    .hamburger.open span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    .dropdown-menu {
      width: 237px;
      z-index: 1000;
      display: none;
      /* Меню по умолчанию скрыто */
      transition: all 0.3s ease-in-out;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
    }

    /* Показываем меню ТОЛЬКО когда у родителя есть класс .active */
    .dropdown-parent.active .dropdown-menu {
      display: block;
    }

    .dropdown-parent::before {
      content: '';
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      height: 12px;
      z-index: 999;
    }

    .dropdown-item {
      position: relative;
      cursor: pointer;
      display: block;
      text-align: center;
    }

    .dropdown-item:hover {
      background-color: rgba(186, 1, 8, 0.1);
    }

    .dropdown-item:not(:last-child)::after {
      content: '';
      position: absolute;
      right: 0;
      top: 20%;
      height: 60%;
      width: 2px;
      background-color: #ba0108;
    }

    #mobile-search-panel {
      position: absolute;
      top: 100%;
      left: 5%;
      /* добавлено для центрирования */
      width: 90%;
      background-color: #050505;
      border-bottom-right-radius: 8px;
      border-bottom-left-radius: 8px;
      z-index: 999;
      overflow: hidden;
      opacity: 0;
      transform: translateY(-10px);
      visibility: hidden;
      transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.3s;
    }

    #mobile-search-panel.open {
      opacity: 1;
      transform: translateY(0);
      visibility: visible;
    }

    @media (min-width: 1024px) {
      .dropdown-item:not(:last-child)::after {
        right: auto;
        top: auto;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        height: 2px;
        width: 58px;
        background-color: #ba0108;
      }
    }

    @media (max-width: 809px) {
      .desktop-nav {
        display: none !important;
      }

      .mobile-nav {
        display: flex !important;
        min-height: 60px;
      }

      .mobile-menu {
        display: flex !important;
      }
    }

    @media (min-width: 810px) {
      .mobile-nav {
        display: none !important;
      }

      .mobile-menu {
        display: none !important;
      }

      .desktop-nav {
        display: flex !important;
      }
    }

    @media (max-width: 1024px) and (min-width: 769px) {
  .nav-container {
    gap: 10px;
  }

  .nav-link {
    font-size: 16px;
  }

  .dropdown-menu {
    min-width: 506px;
  }

  .dropdown-item {
    padding: 12px 16px;
    font-size: 14px;
  }

  .contact-phone {
    display: none;
  }

  .language-switcher {
    gap: 8px;
    font-size: 20px !important;
  }
}
  </style>

  <!-- Responsive container -->
  <div class="flex w-full max-w-[1280px] px-[20px] justify-between items-center nav-container py-5">
    <!-- Logo -->
    <a href="/" class="relative z-[10]" aria-label="Karma - головна сторінка">
      <img src="/logo.png" alt="logo" width="149" height="34" class="w-[108px] h-[25px] md:w-[149px] md:h-[34px]" />
    </a>

    <!-- Desktop Navigation -->
    <nav class="nav-container desktop-nav hidden items-center gap-[50px]" role="navigation" aria-label="Головне меню">
      <div class="relative dropdown-parent">
        <!-- УБРАН onclick="toggleDropdown(event)" -->
        <button
          class="nav-link lg:!font-['Inter'] cursor-pointer font-normal text-xl text-[#fefefe] hover:text-[#ba0108] transition-colors"
          aria-expanded="false" aria-haspopup="true" aria-label="Каталог товарів">
          Каталог
        </button>
        <div class="dropdown-menu absolute left-[-50px] lg:left-[-80px] top-[30px] mt-3 bg-[#020303] rounded-b-[5px]"
          role="menu" aria-label="Підменю каталогу">
          <div class="flex flex-row w-full lg:flex-col">
            <a href="/catalog/politni-steky/"
              class="dropdown-item flex-1 px-8 py-6 text-[#fefefe] lg:font-['Inter'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap"
              role="menuitem">Політні стеки</a>
            <a href="/catalog/videoperedavachi-vtx/"
              class="dropdown-item flex-1 px-8 py-6 text-[#fefefe] lg:font-['Inter'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap"
              role="menuitem">Відеопередавачі VTX</a>
            <a href="/catalog/esc/"
              class="dropdown-item flex-1 px-8 py-6 text-[#fefefe] lg:font-['Inter'] text-lg font-medium hover:text-[#ba0108] transition-all duration-300 whitespace-nowrap"
              role="menuitem">ESC</a>
          </div>
        </div>
      </div>
      <a href="/faq"
        class="nav-link lg:font-['Inter'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors">FAQ</a>
      <a href="/knowledge-base"
        class="nav-link lg:font-['Inter'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors">База
        знань</a>
      <a href="/contact"
        class="nav-link lg:font-['Inter'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors">Контакти</a>
    </nav>
    <nav class="desktop-nav hidden items-baseline justify-center gap-[30px]">
      <a href="tel:(067) 298-29-29"
        class="flex items-center font-['Montserrat'] text-xl font-normal text-[#fefefe] hover:text-[#ba0108] transition-colors hidden lg:block"
        aria-label="Зателефонувати за номером (067) 298-29-29">(067) 298-29-29</a>
      <div class="flex gap-3 items-center justify-center text-xl language-switcher text-[#fefefe]">
        <button id="lang-ua"
          class="font-['Montserrat'] text-xl font-normal cursor-pointer text-[#ba0108] hover:text-[#ba0108]"
          onclick="switchLanguage('ua')" aria-label="Перемкнути на українську мову" aria-pressed="true">UA</button>
        <div class="h-6 w-px bg-white/50" aria-hidden="true"></div>
        <button id="lang-en"
          class="font-['Montserrat'] text-xl !font-normal cursor-pointer !text-[#fefefe] hover:text-[#ba0108]"
          onclick="switchLanguage('en')" aria-label="Switch to English" aria-pressed="false">EN</button>
      </div>
    </nav>

    <!-- Mobile Navigation -->
    <div class="flex gap-4 items-center mobile-nav">
      <button id="search-toggle-button" class="text-[#fefefe] hover:text-[#ba0108] transition-colors"
        aria-label="Відкрити пошук" aria-haspopup="true" aria-expanded="false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true">
          <path
            d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
      <button class="hamburger flex flex-col justify-center items-center w-8 h-8 space-y-1" onclick="toggleMobileMenu()"
        aria-label="Відкрити мобільне меню" aria-expanded="false">
        <span class="block w-6 h-0.5 bg-white"></span>
        <span class="block w-6 h-0.5 bg-white"></span>
        <span class="block w-6 h-0.5 bg-white"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Search Panel -->
  <div id="mobile-search-panel" class="py-[13px] px-[24px]" role="search">
    <div class="relative">
      <input type="text" placeholder="Пошук по сайту"
        class="w-full h-[41px] rounded-full font-['Montserrat'] border-0 pl-6 pr-[110px] text-lg outline-none bg-white text-black placeholder-gray-500"
        id="mobile-search-input" aria-label="Поле для пошуку" autocomplete="off" />
      <button
        class="absolute right-0 top-0 h-[41px] w-[100px] rounded-full bg-[#ba0108] flex items-center justify-center hover:bg-[#a00007]"
        aria-label="Почати пошук" id="mobile-search-button">
        <span class="text-[#fefefe] font-['Montserrat'] text-[13px]">Пошук</span>
      </button>
    </div>
    <div id="mobile-search-results" class="max-h-[60vh] overflow-y-auto mt-2"></div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div id="mobileMenu" class="mobile-menu fixed inset-0 bg-[#020303] z-40 flex flex-col" role="dialog" aria-modal="true"
    aria-label="Мобільне меню">
    <div
      class="flex relative z-[12] justify-between items-center p-4 shadow-[0_2px_8px_rgba(255,255,255,0.4)] bg-[#020303]">
      <a href="/" class="text-xl font-normal text-[#fefefe] font-inter" aria-label="Karma - головна сторінка"><img
          src="/logo.png" alt="logo" width="108" height="25"></a>
      <button class="flex relative flex-col justify-center items-center w-12 h-12 cursor-pointer hamburger"
        onclick="toggleMobileMenu()" aria-label="Закрити мобільне меню">
        <span class="block absolute w-6 h-0.5 bg-white rotate-45" aria-hidden="true"></span>
        <span class="block absolute w-6 h-0.5 bg-white -rotate-45" aria-hidden="true"></span>
      </button>
    </div>
    <nav class="flex flex-col flex-1 items-center px-6 pt-[119px] space-y-6" role="navigation"
      aria-label="Мобільне меню">
      <div class="relative">
        <button onclick="toggleMobileCatalog()"
          class="w-full flex justify-center items-center text-[#fefefe] font-['Unbounded'] text-xl font-normal py-2 cursor-pointer"
          aria-expanded="false" aria-controls="mobile-catalog-submenu" aria-label="Каталог товарів">
          <span class="font-['Unbounded'] text-xl font-normal text-[#fefefe]">Каталог</span>
          <svg class="w-5 h-5 transition-transform transform mobile-catalog-arrow" fill="none" stroke="currentColor"
            viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div class="overflow-hidden max-h-0 opacity-0 transition-all duration-300 ease-in-out mobile-catalog-menu"
          id="mobile-catalog-submenu">
          <div class="flex flex-col items-center pl-4 mt-2 space-y-2">
            <a href="/catalog/politni-steky/"
              class="block text-[#fefefe]/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">Політні
              стеки</a>
            <a href="/catalog/videoperedavachi-vtx/"
              class="block text-[#fefefe]/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">Відеопередавачі
              VTX</a>
            <a href="/catalog/esc/"
              class="block text-[#fefefe]/80 font-['Unbounded'] text-lg py-2 hover:text-[#ba0108] transition-colors">ESC</a>
          </div>
        </div>
      </div>
      <a href="/faq"
        class="text-[#fefefe] font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">FAQ</a>
      <a href="/knowledge-base"
        class="text-[#fefefe] font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">База
        знань</a>
      <a href="/contact"
        class="text-[#fefefe] font-['Unbounded'] text-xl font-normal hover:text-[#ba0108] transition-colors">Контакти</a>
      <div class="flex absolute bottom-10 flex-col items-center">
        <a href="tel:(067) 298-29-29"
          class="block text-[#fefefe] font-['Montserrat'] text-xl font-normal mb-4 hover:text-[#ba0108] transition-colors">(067)
          298-29-29</a>
        <div class="flex gap-3 items-center text-2xl text-[#fefefe]">
          <button id="mobile-lang-ua"
            class="font-['Montserrat'] text-xl !font-normal cursor-pointer !text-[#ba0108] hover:text-[#ba0108]"
            onclick="switchLanguage('ua')" aria-label="Перемкнути на українську мову" aria-pressed="true">UA</button>
          <span aria-hidden="true">|</span>
          <button id="mobile-lang-en"
            class="font-['Montserrat'] text-xl !font-normal cursor-pointer !text-[#fefefe] hover:text-[#ba0108]"
            onclick="switchLanguage('en')" aria-label="Switch to English" aria-pressed="false">EN</button>
        </div>
      </div>
    </nav>
  </div>
</header>

<script>
  // --- ОБЩИЕ ФУНКЦИИ УПРАВЛЕНИЯ ИНТЕРФЕЙСОМ ---
  function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    const hamburger = document.querySelector('.hamburger');
    const isOpen = mobileMenu.classList.contains('open');
    mobileMenu.classList.toggle('open');
    hamburger.classList.toggle('open');
    hamburger.setAttribute('aria-expanded', String(!isOpen));
    document.body.style.overflow = isOpen ? '' : 'hidden';
  }

  function toggleMobileCatalog() {
    const catalogMenu = document.querySelector('.mobile-catalog-menu');
    const arrow = document.querySelector('.mobile-catalog-arrow');
    const button = document.querySelector('[aria-controls="mobile-catalog-submenu"]');
    if (!catalogMenu || !arrow || !button) return;
    const isExpanded = button.getAttribute('aria-expanded') === 'true';
    if (isExpanded) {
      catalogMenu.classList.add('max-h-0', 'opacity-0');
      catalogMenu.classList.remove('max-h-96', 'opacity-100');
      arrow.classList.remove('rotate-180');
      button.setAttribute('aria-expanded', 'false');
    } else {
      catalogMenu.classList.remove('max-h-0', 'opacity-0');
      catalogMenu.classList.add('max-h-96', 'opacity-100');
      arrow.classList.add('rotate-180');
      button.setAttribute('aria-expanded', 'true');
    }
  }

  function switchLanguage(lang) {
    const uaDesktop = document.getElementById('lang-ua');
    const enDesktop = document.getElementById('lang-en');
    const uaMobile = document.getElementById('mobile-lang-ua');
    const enMobile = document.getElementById('mobile-lang-en');
    if (!uaDesktop || !enDesktop || !uaMobile || !enMobile) return;
    const isUa = lang === 'ua';
    uaDesktop.className = isUa ? "font-['Inter'] text-xl !font-bold cursor-pointer !text-[#ba0108] hover:text-[#ba0108]" : "font-['Montserrat'] text-xl !font-normal cursor-pointer !text-[#fefefe] hover:text-[#ba0108]";
    enDesktop.className = !isUa ? "font-['Inter'] text-xl !font-bold cursor-pointer !text-[#ba0108] hover:text-[#ba0108]" : "font-['Montserrat'] text-xl !font-normal cursor-pointer !text-[#fefefe] hover:text-[#ba0108]";
    uaMobile.className = isUa ? "!font-[Inter] font-bold cursor-pointer text-[#ba0108] hover:text-[#ba0108]" : "!font-[Montserrat] font-normal cursor-pointer text-[#fefefe]/80 hover:text-[#ba0108]";
    enMobile.className = !isUa ? "!font-[Inter] font-bold cursor-pointer text-[#ba0108] hover:text-[#ba0108]" : "!font-[Montserrat] font-normal cursor-pointer text-[#fefefe]/80 hover:text-[#ba0108]";
    uaDesktop.setAttribute('aria-pressed', String(isUa));
    enDesktop.setAttribute('aria-pressed', String(!isUa));
    uaMobile.setAttribute('aria-pressed', String(isUa));
    enMobile.setAttribute('aria-pressed', String(!isUa));
    localStorage.setItem('selectedLanguage', lang);
  }

  // --- ГЛАВНЫЙ ОБРАБОТЧИК СОБЫТИЙ ПОСЛЕ ЗАГРУЗКИ СТРАНИЦЫ ---
  document.addEventListener('DOMContentLoaded', function () {

    // --- ИСПРАВЛЕННАЯ ЛОГИКА ДЛЯ ВЫПАДАЮЩЕГО МЕНЮ "КАТАЛОГ" ---
    const dropdownParents = document.querySelectorAll('.dropdown-parent');
    dropdownParents.forEach(parent => {
      const dropdownMenu = parent.querySelector('.dropdown-menu');
      let hoverTimeout;

      parent.addEventListener('mouseenter', () => {
        clearTimeout(hoverTimeout); // Отменяем таймер, если он был
        parent.classList.add('active'); // Сразу показываем меню
      });

      parent.addEventListener('mouseleave', () => {
        // Устанавливаем таймер на скрытие меню
        hoverTimeout = setTimeout(() => {
          parent.classList.remove('active');
        }, 300); // 300 мс задержка
      });

      // Если курсор перешел на само меню, отменяем таймер скрытия
      if (dropdownMenu) {
        dropdownMenu.addEventListener('mouseenter', () => {
          clearTimeout(hoverTimeout);
        });
        // Когда курсор покидает и само меню, ставим таймер на скрытие
        dropdownMenu.addEventListener('mouseleave', () => {
          hoverTimeout = setTimeout(() => {
            parent.classList.remove('active');
          }, 300);
        });
      }
    });


    // --- ЛОГИКА ПОИСКА (осталась без изменений) ---
    const searchPanel = document.getElementById('mobile-search-panel');
    const searchInput = document.getElementById('mobile-search-input');
    const searchResults = document.getElementById('mobile-search-results');
    const searchButton = document.getElementById('mobile-search-button');
    const searchToggleButton = document.getElementById('search-toggle-button');
    const contentArea = document.querySelector('main, article, .content, .page-content, body');

    const style = document.createElement('style');
    style.textContent = `
        @keyframes searchFocusAnimation {
            from { background-color: rgba(186, 1, 8, 0.25); }
            to { background-color: transparent; }
        }
        .search-result-focus {
            animation: searchFocusAnimation 1.5s ease-in-out;
            scroll-margin-top: 100px;
        }
    `;
    document.head.appendChild(style);

    let searchResultsData = [];

    function clearSearch() {
      if (searchResults) searchResults.innerHTML = '';
      searchResultsData = [];
      document.querySelectorAll('span[id^="temp-search-result-"]').forEach(marker => {
        if (marker.parentNode) marker.replaceWith(document.createTextNode(marker.textContent));
      });
      if (contentArea) contentArea.normalize();
    }

    function executeSearch() {
      clearSearch();
      if (!contentArea) return;
      const query = searchInput.value.trim();
      if (query.length < 2) return;
      const regex = new RegExp(`(${query.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
      let resultIndex = 0;
      const walker = document.createTreeWalker(contentArea, NodeFilter.SHOW_TEXT, {
        acceptNode: node => (node.parentNode.closest('script, style, header, #mobile-search-panel') || !node.textContent.trim() || !regex.test(node.textContent)) ? NodeFilter.FILTER_REJECT : NodeFilter.FILTER_ACCEPT
      });
      const nodesToProcess = [];
      while (walker.nextNode()) nodesToProcess.push(walker.currentNode);
      nodesToProcess.forEach(textNode => {
        const fragment = document.createDocumentFragment();
        let lastIndex = 0;
        textNode.textContent.replace(regex, (match, ...args) => {
          const offset = args[args.length - 2];
          if (offset > lastIndex) fragment.appendChild(document.createTextNode(textNode.textContent.substring(lastIndex, offset)));
          const markerSpan = document.createElement('span');
          const resultId = `temp-search-result-${resultIndex++}`;
          markerSpan.id = resultId;
          markerSpan.textContent = match;
          fragment.appendChild(markerSpan);
          searchResultsData.push({ id: resultId, context: getContext(textNode.textContent, match, offset) });
          lastIndex = offset + match.length;
        });
        if (lastIndex < textNode.textContent.length) fragment.appendChild(document.createTextNode(textNode.textContent.substring(lastIndex)));
        textNode.parentNode.replaceChild(fragment, textNode);
      });
      displayResults();
    }

    function getContext(fullText, match, matchIndex) {
      const contextLength = 60;
      const start = Math.max(0, matchIndex - contextLength);
      const end = Math.min(fullText.length, matchIndex + match.length + contextLength);
      let context = (start > 0 ? '...' : '') + fullText.substring(start, end) + (end < fullText.length ? '...' : '');
      return context.replace(new RegExp(`(${match})`, 'gi'), '<span class="text-[#ba0108] font-semibold">$1</span>');
    }

    function displayResults() {
      if (!searchResults) return;
      searchResults.innerHTML = '';
      if (searchResultsData.length > 0) {
        searchResultsData.forEach(result => {
          const resultElement = document.createElement('div');
          resultElement.className = 'block p-3 text-white/90 bg-[#1a1a1a] hover:bg-[#2a2a2a] rounded-md my-1 text-sm cursor-pointer';
          resultElement.innerHTML = `<div>${result.context}</div>`;
          resultElement.addEventListener('click', () => scrollToResult(result.id));
          searchResults.appendChild(resultElement);
        });
      } else {
        searchResults.innerHTML = `<div class="p-3 text-white/60 text-center">Ничего не найдено</div>`;
      }
    }

    function scrollToResult(resultId) {
      const element = document.getElementById(resultId);
      if (element) {
        searchPanel.classList.remove('open');
        searchToggleButton.setAttribute('aria-expanded', 'false');
        const parentBlock = element.closest('p, li, h1, h2, h3, h4, td, th, div:not(:empty)');
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        if (parentBlock) {
          parentBlock.classList.add('search-result-focus');
          setTimeout(() => {
            parentBlock.classList.remove('search-result-focus');
            clearSearch();
            searchInput.value = '';
          }, 1500);
        } else {
          clearSearch();
          searchInput.value = '';
        }
      }
    }

    function closeSearchPanel() {
      searchPanel.classList.remove('open');
      searchToggleButton.setAttribute('aria-expanded', 'false');
      searchInput.value = '';
      clearSearch();
    }

    function toggleSearchPanel() {
      if (searchPanel.classList.contains('open')) {
        closeSearchPanel();
      } else {
        if (document.getElementById('mobileMenu')?.classList.contains('open')) toggleMobileMenu();
        searchPanel.classList.add('open');
        searchToggleButton.setAttribute('aria-expanded', 'true');
        setTimeout(() => searchInput.focus(), 300);
      }
    }

    searchToggleButton.addEventListener('click', toggleSearchPanel);
    searchButton.addEventListener('click', executeSearch);
    searchInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') executeSearch(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && searchPanel.classList.contains('open')) closeSearchPanel(); });
    if (typeof switchLanguage === 'function') {
      switchLanguage(localStorage.getItem('selectedLanguage') || 'ua');
    }
  });
</script>