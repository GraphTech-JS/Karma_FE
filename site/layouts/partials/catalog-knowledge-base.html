{{ $category := .Params.category | default "politni-steky" }}
{{ $categoryData := index .Site.Data.products.categories $category }}

{{/* Get guides from content files */}}
{{ $guides := where .Site.RegularPages "Section" "guides" }}
{{ $categoryGuides := slice }}

{{/* Map product categories to guide categories */}}
{{ if eq $category "politni-steky" }}
{{ $categoryGuides = where $guides ".Params.category" "Політні стеки" }}
{{ else if eq $category "videoperedavachi-vtx" }}
{{ $categoryGuides = where $guides ".Params.category" "Відеопередавачі" }}
{{ else if eq $category "esc" }}
{{ $categoryGuides = where $guides ".Params.category" "ESC" }}
{{ else }}
{{ $categoryGuides = $guides }}
{{ end }}

<div
    class="flex justify-center items-center flex-col max-w-[1237px] w-full mx-auto my-[clamp(40px,6vw,80px)] px-[clamp(20px,4vw,40px)]">
    <h3
        class="title hero-title text-black text-[clamp(24px,3vw,40px)] text-center font-[Unbounded] font-medium mb-[clamp(20px,3vw,30px)]">
        <span class="text-[#ba0108]">Б</span>АЗА ЗНАНЬ. {{ $categoryData.name | upper }}
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-[clamp(16px,3vw,21px)] max-[450px]:gap-4">
        {{ range $categoryGuides | first 3 }}
        <div class="flex flex-col gap-[clamp(8px,2vw,10px)] max-w-[clamp(280px,80vw,400px)] max-[450px]:max-w-full">
            {{ if .Params.image }}
            {{ $guideImage := resources.Get .Params.image }}
            {{ if $guideImage }}
            {{ $guideImageProcessed := $guideImage.Resize "400x238 webp q80" }}
            <img src="{{ $guideImageProcessed.RelPermalink }}" alt="{{ .Title }}" width="400"
                class="rounded-lg w-[350px] md:w-[300px] lg:w-[400px] max-[450px]:w-full h-[238px]  object-cover" />
            {{ else }}
            <img src="{{ .Params.image }}" alt="{{ .Title }}" width="400"
                class="rounded-lg w-[350px] md:w-[300px] lg:w-[400px] max-[450px]:w-full h-[238px]  object-cover" />
            {{ end }}
            {{ else }}
            {{ $defaultImage := resources.Get "img/card-img-1.png" }}
            {{ if $defaultImage }}
            {{ $defaultImageProcessed := $defaultImage.Resize "400x238 webp q80" }}
            <img src="{{ $defaultImageProcessed.RelPermalink }}" alt="{{ .Title }}" width="400"
                class="rounded-lg w-[350px] md:w-[300px] lg:w-[400px] max-[450px]:w-full h-[238px]  object-cover" />
            {{ else }}
            <img src="/img/card-img-1.png" alt="{{ .Title }}" width="400"
                class="rounded-lg w-[350px] md:w-[300px] lg:w-[400px] max-[450px]:w-full h-[238px]  object-cover" />
            {{ end }}
            {{ end }}
            <div
                class="flex flex-col gap-[clamp(8px,2vw,10px)]  max-[450px]:h-auto justify-between">
                <h4
                    class="text-[clamp(20px,2vw,24px)] max-[450px]:text-[18px] font-[Montserrat] font-medium max-[450px]:leading-tight">
                    {{ .Title }}
                </h4>
                <p
                    class="text-[clamp(16px,2vw,20px)] max-[450px]:text-[14px] font-[Montserrat] font-normal max-[450px]:leading-relaxed">
                    {{ .Params.description | default .Summary }}
                    <a class="text-[#ba0108] ml-[clamp(4px,1vw,8px)]" href="{{ .Permalink }}">
                        &gt;&gt;
                    </a>
                </p>
            </div>
        </div>
        {{ end }}

        {{ if lt (len $categoryGuides) 1 }}
        <div class="text-center">
            <p class="text-[clamp(16px,2vw,20px)] font-[Montserrat] font-normal text-gray-500">
                Поки що немає статей для цієї категорії. Додайте їх через CMS.
            </p>
        </div>
        {{ end }}
    </div>
</div>

<style>
    @keyframes fadeInUp {
        0% {
            opacity: 0;
            transform: translateY(30px);
        }

        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .hero-title {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.6s ease-out;
    }

    .hero-title.animate {
        animation: fadeInUp 0.8s ease-out forwards;
    }
</style>

<script>
    // Hero title animation
    function animateHeroTitle() {
        const heroTitles = document.querySelectorAll('.hero-title');

        const observerOptions = {
            threshold: 0.3,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate');
                } else {
                    entry.target.classList.remove('animate');
                }
            });
        }, observerOptions);

        heroTitles.forEach(title => {
            observer.observe(title);
        });
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', animateHeroTitle);
</script>