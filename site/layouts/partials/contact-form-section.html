<section id="contact-form-section"
  class=" relative flex justify-center items-center px-4 pt-[100px] md:pt-[60px] lg:pt-[80px] pb-[80px] {{ if not (eq .RelPermalink "/contact/") }}{{ end }}">
  {{ if eq .RelPermalink "/contact/" }}
  {{ $bgEl1 := resources.Get "img/bg-el-1.png" }}
  {{ if $bgEl1 }}
  {{ $bgEl1Processed := $bgEl1.Resize "420x webp q80" }}
  <img src="{{ $bgEl1Processed.RelPermalink }}" alt="Декоративний фоновий елемент" aria-hidden="true"
    class="absolute md:hidden block  z-[1] right-[-45px] top-[-70px] w-[201px] h-auto" />
  {{ else }}
  <img src="/img/bg-el-1.png" alt="Декоративний фоновий елемент" aria-hidden="true"
    class="absolute md:hidden block  z-[1] right-[-45px] top-[-70px] w-[201px] h-auto" />
  {{ end }}
  {{ $bgEl2 := resources.Get "img/bg-el-1.png" }}
  {{ if $bgEl2 }}
  {{ $bgEl2Processed := $bgEl2.Resize "420x webp q80" }}
  <img src="{{ $bgEl2Processed.RelPermalink }}" alt="Декоративний фоновий елемент" aria-hidden="true"
    class="absolute md:hidden block  z-[1] left-[-45px] top-[-70px]  w-[201px] h-auto -scale-x-100" />
  {{ else }}
  <img src="/img/bg-el-2.png" alt="Декоративний фоновий елемент" aria-hidden="true"
    class="absolute md:hidden block z-[1] left-[-45px] top-[-70px] w-[201px] h-auto -scale-x-100" />
  {{ end }}
  {{ end }}

  <div class="hidden lg:block absolute right-[-12%]  top-0">
    {{ $bgEl5 := resources.Get "img/bg-contact-form.png" }}
    {{ if $bgEl5 }}
    {{ $bgEl5Processed := $bgEl5.Resize "627x webp q80" }}
    <img src="{{ $bgEl5Processed.RelPermalink }}" alt="background-element-two"
      class=" w-[250px] object-contain  h-[627px] lg:w-[417px]" />
    {{ else }}
    <img src="/img/bg-contact-form.png" alt="background-element-two"
      class="w-[250px] object-contain h-[627px] lg:w-[417px]" />
    {{ end }}
  </div>


  <div id="toast-container"
    class="absolute top-8 left-1/2 z-50 px-4 space-y-2 w-full max-w-md transform -translate-x-1/2"></div>

  <div
    class="w-full max-w-[1237px] mx-auto relative z-10 flex flex-col md:flex-col xl:flex-row xl:justify-between xl:items-center lg:gap-[clamp(20px,4vw,32px)]">
    <div class="flex flex-col w-full text-center md:text-left">
      <h3 class=" !text-[24px] md:!text-[32px] lg:!text-[40px] font-medium font-['Unbounded'] hero-title mb-[10px]">
        <span class="text-[#BA0108]">{{i18n "contact.title.brand"}}</span>{{i18n "contact.title"}}
      </h3>
      <p class="mb-[23px] text-[16px] md:text-[20px] font-normal text-black font-['Montserrat'] ">
        {{i18n "contact.subtitle"}}
      </p>

      <!-- Netlify form -->
      <form id="contact-form" name="contact" method="POST" data-netlify="true" netlify-honeypot="bot-field"
        class="flex flex-col font-['Montserrat'] w-full" novalidate>
        <input type="hidden" name="form-name" value="contact" />
        <p class="hidden"><label>Don’t fill this out if you’re human: <input name="bot-field" /></label></p>

        <div class="flex flex-col gap-[23px]  md:flex-row xl:flex-row mb-[23px]">
          <input type="text" id="name" placeholder="{{i18n "contact.form.name.placeholder"}}" required name="name"
            class="contact-input w-full  xl:w-[373px] xl:flex-none px-5 py-4 h-[65px] placeholder:text-[#999] border border-[#404040] rounded-[5px] text-normal bg-white transition-all duration-300 ease-in-out" />
          <input type="tel" id="phone" placeholder="{{i18n "contact.form.phone.placeholder"}}" required name="phone"
            class="contact-input w-full xl:w-[373px] xl:flex-none px-5 py-4 h-[65px] placeholder:text-[#999] border border-[#404040] rounded-[5px] text-normal bg-white transition-all duration-300 ease-in-out" />
        </div>

        <textarea id="message" name="message" placeholder="{{i18n "contact.form.message.placeholder"}}" rows="5"
          class="contact-textarea w-full  xl:w-[770px] px-5 py-4 placeholder:text-[#999] border border-[#404040] rounded-[5px] text-normal bg-white resize-y min-h-[120px] transition-all duration-300 ease-in-out font-['Montserrat']"></textarea>

        <button type="submit" id="submit-btn"
          class="contact-button !mt-[50px] md:!mt-[27px] w-full  xl:w-[770px] bg-[#ba0108] hover:bg-[#e39599] transition-colors text-white border-none px-10 h-[65px] md:h-[70px] lg:h-auto lg:py-5 rounded-2xl cursor-pointer text-[clamp(16px,2vw,24px)] font-light lg:font-normal font-['Montserrat'] duration-300 ease-in-out">
          {{i18n "contact.form.submit"}}
        </button>
      </form>
    </div>
    <div
      class="flex flex-col max-[640px]:gap-0 max-[1025px]:gap-5 justify-center items-center mt-8 text-center sm:flex-row sm:items-center sm:text-left md:flex-row lg:flex-row lg:items-center lg:justify-center lg:text-center xl:flex-col xl:items-start xl:text-left xl:mt-0">
      <h4
        class="text-[clamp(16px,2vw,20px)] font-light sm:font-normal text-[#000] font-['Montserrat'] mb-3 sm:mb-0 lg:mb-0 xl:mb-3 leading-[120%]">
        {{i18n "contact.department"}}
      </h4>
      <div class="flex flex-col gap-[10px] max-[450px]:gap-1 lg:gap-0 xl:gap-0">
        <a href="tel:+380 63 202 57 77" class="block text-[clamp(24px,3vw,36px)] font-normal text-[#ba0108] 
             no-underline transition-colors duration-300 ease-in-out font-['Unbounded'] 
             hover:text-red-800 leading-[120%]">
          {{i18n "contact.form.phone"}}
        </a>
        <a href="mailto:Contact@karma.flights" class="block text-[clamp(24px,3vw,36px)] font-normal text-gray-900 
             no-underline transition-colors duration-300 ease-in-out font-['Unbounded'] 
             hover:text-gray-700 leading-[120%]">
          {{i18n "contact.form.email"}}
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contact-form');
    const nameInput = document.getElementById('name');
    const phoneInput = document.getElementById('phone');
    const messageInput = document.getElementById('message');
    const submitBtn = document.getElementById('submit-btn');
    const toastContainer = document.getElementById('toast-container');

    function showToast(message, type = 'error', hideMs = 4000) {
      if (!toastContainer) return;
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      toastContainer.appendChild(toast);
      requestAnimationFrame(() => toast.classList.add('show'));
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 350);
      }, hideMs);
    }

    function normalizePhoneToUA(value) {
      const digits = (value || '').replace(/\D/g, '');
      if (digits.length === 12 && digits.startsWith('380')) return '+' + digits;
      if (digits.length === 10 && digits.startsWith('0')) return '+38' + digits;
      return null;
    }

    function validateForm() {
      let valid = true;
      [nameInput, phoneInput].forEach(el => el.classList.remove('error', 'success'));
      const nameVal = (nameInput.value || '').trim();
      if (!nameVal) { nameInput.classList.add('error'); showToast('{{i18n "contact.form.error.name"}}'); valid = false; }
      else { nameInput.classList.add('success'); }
      const normalizedPhone = normalizePhoneToUA(phoneInput.value);
      if (!normalizedPhone) { phoneInput.classList.add('error'); showToast('{{i18n "contact.form.error.phone"}}'); valid = false; }
      else { phoneInput.classList.add('success'); }
      return valid;
    }

    async function submitToNetlify(form) {
      const formData = new FormData(form);
      const body = new URLSearchParams(formData).toString();
      await fetch('/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body
      });
    }

    if (form) {
      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        if (!validateForm()) return;

        submitBtn.disabled = true;
        submitBtn.textContent = '{{i18n "contact.form.submitting"}}';

        try {
          await submitToNetlify(form);
          showToast('{{i18n "contact.form.success"}}', 'success', 5000);
          form.reset();
        } catch (err) {
          showToast('Помилка надсилання форми', 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = '{{i18n "contact.form.submit"}}';
        }
      });
    }
  });
</script>