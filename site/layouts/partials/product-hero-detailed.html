{{- $product := .product | default dict -}}
{{- $context := .context | default . -}}

{{- $productName := $product.name | default $context.Title | default (i18n "product.hero.title.fallback") -}}
{{- $description := $context.Params.description | default (i18n "product.hero.description.fallback") -}}

{{- $words := split $productName " " -}}
{{- $firstTwo := first 2 $words -}}
{{- $rest := after 2 $words -}}

{{- $rawCategory := $context.Params.category | default $product.category | default "politni-steky" -}}
{{- $slugMap := dict
"Політні стеки" "politni-steky"
"Flight Stacks" "politni-steky"
"Відеопередавачі" "videoperedavachi-vtx"
"Відеопередавачі VTX" "videoperedavachi-vtx"
"Video transmitters" "videoperedavachi-vtx"
"Video Transmitters" "videoperedavachi-vtx"
"ESC" "esc"
-}}
{{- $categorySlug := $context.Params.categorySlug | default (index $slugMap $rawCategory) | default $rawCategory -}}

{{- $catKey := printf "catalog.category.%s" $categorySlug -}}
{{- $categoryI18n := i18n $catKey -}}
{{- $categoryData := index $context.Site.Data.products.categories $categorySlug -}}

{{- $categoryName := $rawCategory -}}
{{- if ne $categoryI18n $catKey -}}
{{- $categoryName = $categoryI18n -}}
{{- else -}}
{{- with $categoryData -}}
{{- with .name -}}
{{- $categoryName = . -}}
{{- end -}}
{{- end -}}
{{- end -}}

{{- $categoryNameBreadcrumb := $categoryName -}}
{{- if gt (len $categoryNameBreadcrumb) 0 -}}
{{- $categoryNameBreadcrumb = printf "%s%s" (upper (substr $categoryNameBreadcrumb 0 1)) (substr $categoryNameBreadcrumb
1) -}}
{{- end -}}

<section class="overflow-hidden relative bg-white">
  <div
    class="w-full max-w-[1280px] flex flex-col mx-auto px-[clamp(20px,4vw,40px)] pt-[20px] md:pt-[40px] relative z-[2]">

    <!-- Breadcrumbs -->
    <nav aria-label="{{ i18n " product.hero.aria.breadcrumb" }}"
      class="flex flex-row items-start font-[Montserrat] gap-[clamp(8px,2vw,16px)] mb-[40px]">
      <ol class="flex flex-wrap items-center">
        <li>
          <a href="{{ .Site.Home.RelPermalink }}" class="text-[#ba0108] font-normal text-[16px] lg:text-[20px]">
            {{ i18n "product.hero.breadcrumb.home" }}
          </a>
        </li>
        <li class="text-[#ba0108] px-[5px]" aria-hidden="true">&rarr;</li>
        <li>
          <a href="{{ (printf " /catalog/%s/" $categorySlug) | relLangURL }}"
            class="text-[#ba0108] font-normal text-[16px] lg:text-[20px]">
            {{ $categoryNameBreadcrumb }}
          </a>
        </li>
        <li class="text-[#ba0108] px-[5px]" aria-hidden="true">&rarr;</li>
        <li><span class="text-[#ba0108] font-normal text-[16px] lg:text-[20px]">{{ $productName }}</span></li>
      </ol>
    </nav>

    <!-- Product Hero -->
    <div class="flex flex-col gap-[clamp(24px,4vw,48px)] sm:flex-row md:items-start items-center">
      <div class="flex relative flex-col items-center mb-6 w-full md:flex-row">
        {{- $productImage := ($product.image | default "/img/Stack-product.png") | strings.TrimPrefix "/" -}}
        {{- $productImageResource := resources.Get $productImage -}}
        {{- if $productImageResource -}}
        {{- $imgMobile := $productImageResource.Resize "320x240 webp q75" -}}
        {{- $imgTablet := $productImageResource.Resize "480x360 webp q80" -}}
        {{- $imgDesktop := $productImageResource.Resize "550x367 webp q85" -}}
        <picture>
          <source media="(max-width:767px)" srcset="{{ $imgMobile.RelPermalink }}" type="image/webp">
          <source media="(max-width:1023px)" srcset="{{ $imgTablet.RelPermalink }}" type="image/webp">
          <source media="(min-width:1024px)" srcset="{{ $imgDesktop.RelPermalink }}" type="image/webp">
          <img src="{{ $imgDesktop.RelPermalink }}" alt="{{ $productName }}"
            class="object-contain max-w-none relative z-10 w-[clamp(350px,40vw,550px)] h-[clamp(230px,25vw,367px)]"
            width="550" height="367" loading="eager" decoding="async" />
        </picture>
        {{- end -}}
      </div>

      <div
        class="flex flex-col items-center md:items-start lg:items-start pt-[43px] max-w-full md:max-w-[519px] lg:max-w-[531px] xl:max-w-[578px]">
        <h1
          class="font-[Unbounded] uppercase font-medium leading-[1.1] text-[32px] md:text-[48px] w-full text-center md:text-left lg:text-left mb-2">
          <span class="text-[#ba0108]">{{ delimit $firstTwo " " }}</span>
          {{ if gt (len $rest) 0 }}<span class="text-black"> {{ delimit $rest " " }}</span>{{ end }}
        </h1>

        <p class="font-[Montserrat] text-[16px] lg:text-[20px] text-[#020303] leading-[120%]">
          {{ $description }}
        </p>

        <p class="font-[Montserrat] text-[16px] lg:text-[20px] text-[#020303] mt-5 mb-14 leading-[120%]">
          {{ i18n "product.hero.text.extra" }}
        </p>

        <button onclick="window.openContactModal()" aria-label="{{ printf " %s %s" (i18n "product.hero.aria.ctaPrefix" )
          $productName }}"
          class="product-hero-button text-[16px] md:text-[24px] cursor-pointer font-medium text-white bg-[#ba0108] hover:bg-[#e39599] transition-colors w-full max-w-[458px] h-[58px] md:h-[70px] rounded-[20px] shadow">
          {{ i18n "product.hero.cta" }}
        </button>
      </div>
    </div>
  </div>
</section>