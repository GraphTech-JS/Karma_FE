{{ define "main" }}
<section class="bg-white min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header with Breadcrumbs and Search -->
    <div class="mb-8 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <!-- Breadcrumbs -->
      <div class="flex items-center justify-start gap-2 text-[var(--color-karma-red)] font-[Montserrat]">
        <a class="font-[Montserrat] text-[20px] font-normal text-[#ba0108]" href="/">
          Головна
        </a>
        <span class="text-[#ba0108]">&rarr;</span>
        <a class="font-[Montserrat] text-[20px] font-normal text-[#ba0108]" href="#">
          База знань
        </a>
      </div>

      <!-- Search Section -->
      <div class="flex items-center max-w-md">
        <div class="relative flex-1">
          <input 
            type="text" 
            placeholder="Введіть текст" 
            class="h-[47px] w-full !rounded-[20px] border border-[#E0E0E0] pl-4 pr-[120px] text-[20px] outline-none focus:border-[#ba0108] bg-white"
            id="knowledge-search"
          />
          <button class="absolute z-10 right-0 top-1/2 -translate-y-1/2 w-[99px] h-[47px] rounded-[20px] bg-[#ba0108] flex items-center justify-center cursor-pointer hover:bg-[#a00007] transition-colors">
            <img src="/img/search-icon.svg" alt="search" width="30" height="30" class="filter brightness-0 invert" />
          </button>
        </div>
      </div>
    </div>

    <!-- Accordion Sections -->
    <div class="max-w-5xl mx-auto space-y-0">
      {{ $categories := slice "БПЛА" "ВІДЕОПЕРЕДАВАЧІ" "ESC" }}
      {{ $guides := where .Site.RegularPages "Section" "guides" }}
      {{ range $index, $category := $categories }}
      {{ $categoryGuides := where $guides ".Params.category" $category }}
      <div class="knowledge-section">
        <!-- Section Header -->
        <div class="section-header {{ if eq $index 0 }}bg-[#ba0108]{{ else }}bg-[#4a4a4a]{{ end }} text-white rounded-none">
          <button class="w-full flex items-center justify-between px-8 py-6 text-left focus:outline-none" 
                  onclick="toggleSection(this)">
            <h2 class="text-2xl font-bold font-[Montserrat] tracking-wide">{{ $category }}</h2>
            <svg class="w-8 h-8 transform transition-transform duration-300 section-chevron {{ if eq $index 0 }}rotate-180{{ end }}" 
                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
        </div>

        <!-- Section Content -->
        <div class="section-content {{ if eq $index 0 }}block{{ else }}hidden{{ end }} bg-white">
          {{ if $categoryGuides }}
          <div class="accordion-items">
            {{ range $categoryGuides }}
            <div class="knowledge-item border-b border-gray-200 last:border-b-0">
              <div class="flex cursor-pointer select-none items-start px-8 py-6 hover:bg-gray-50 transition-colors"
                   onclick="window.location.href='{{ .Permalink }}'">
                <div class="flex items-start space-x-4 flex-1">
                  <svg class="w-4 h-4 text-[#ba0108] flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                  </svg>
                  <div class="flex-1">
                    <h3 class="text-lg font-medium text-gray-900 font-[Montserrat] mb-2">{{ .Title }}</h3>
                    {{ if .Params.description }}
                    <p class="text-sm text-gray-600 leading-relaxed font-[Montserrat]">{{ .Params.description }}</p>
                    {{ end }}
                  </div>
                </div>
                <div class="text-xs text-gray-500 text-right ml-4">
                  <span class="text-[#ba0108] underline cursor-pointer">&gt;&gt;</span>
                </div>
              </div>
            </div>
            {{ end }}
          </div>
          {{ else }}
          <div class="px-8 py-12 text-center text-gray-500">
            <p class="text-lg font-[Montserrat]">Контент скоро буде додано</p>
          </div>
          {{ end }}
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>

<style>
/* Section Header Styles */
.section-header {
  border: none;
  box-shadow: none;
}

.section-header button:hover {
  opacity: 0.95;
}

.section-content {
  border-left: 1px solid #e5e7eb;
  border-right: 1px solid #e5e7eb;
  border-bottom: 1px solid #e5e7eb;
}

/* Knowledge Item Styles */
.knowledge-item:hover {
  background-color: #f9fafb;
}

.knowledge-item h3 {
  transition: color 0.2s ease;
}

.knowledge-item:hover h3 {
  color: #ba0108;
}

/* Search functionality */
.knowledge-item.hidden {
  display: none;
}

.knowledge-item.highlighted {
  background-color: #fef2f2;
}

/* Responsive Design */
@media (max-width: 768px) {
  .section-header button {
    padding: 1rem;
  }
  
  .section-header h2 {
    font-size: 1.25rem;
  }
  
  .knowledge-item {
    padding: 1rem;
  }
  
  .knowledge-item h3 {
    font-size: 1rem;
  }
  
  .knowledge-item p {
    font-size: 0.875rem;
  }
}

@media (max-width: 480px) {
  .section-header button {
    padding: 0.75rem;
  }
  
  .knowledge-item {
    padding: 0.75rem;
  }
  
  .knowledge-item h3 {
    font-size: 0.875rem;
  }
}
</style>

<script>
// Section toggle functionality
function toggleSection(button) {
  const section = button.closest('.knowledge-section');
  const content = section.querySelector('.section-content');
  const chevron = button.querySelector('.section-chevron');
  
  if (content.classList.contains('hidden')) {
    content.classList.remove('hidden');
    content.classList.add('block');
    chevron.style.transform = 'rotate(180deg)';
  } else {
    content.classList.remove('block');
    content.classList.add('hidden');
    chevron.style.transform = 'rotate(0deg)';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Search functionality
  const searchInput = document.getElementById('knowledge-search');
  const searchButton = searchInput?.nextElementSibling;
  
  function performSearch() {
    const query = searchInput.value.trim();
    if (query) {
      searchInContent(query);
    } else {
      resetSearch();
    }
  }
  
  if (searchInput && searchButton) {
    searchButton.addEventListener('click', performSearch);
    
    searchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
    
    // Real-time search as user types
    searchInput.addEventListener('input', function() {
      const query = this.value.trim();
      if (query.length > 2) {
        searchInContent(query);
      } else if (query.length === 0) {
        resetSearch();
      }
    });
  }
});

function searchInContent(query) {
  const sections = document.querySelectorAll('.knowledge-section');
  let found = false;
  
  sections.forEach(function(section) {
    const content = section.querySelector('.section-content');
    const items = section.querySelectorAll('.knowledge-item');
    let sectionHasMatch = false;
    
    items.forEach(function(item) {
      const title = item.querySelector('h3')?.textContent.toLowerCase() || '';
      const description = item.querySelector('p')?.textContent.toLowerCase() || '';
      
      if (title.includes(query.toLowerCase()) || description.includes(query.toLowerCase())) {
        item.classList.remove('hidden');
        item.classList.add('highlighted');
        sectionHasMatch = true;
        found = true;
      } else {
        item.classList.add('hidden');
        item.classList.remove('highlighted');
      }
    });
    
    if (sectionHasMatch) {
      content.classList.remove('hidden');
      content.classList.add('block');
      const chevron = section.querySelector('.section-chevron');
      if (chevron) {
        chevron.style.transform = 'rotate(180deg)';
      }
    } else {
      // Hide sections with no matches during search
      content.classList.add('hidden');
      content.classList.remove('block');
      const chevron = section.querySelector('.section-chevron');
      if (chevron) {
        chevron.style.transform = 'rotate(0deg)';
      }
    }
  });
  
  if (!found && query.length > 0) {
    // Show a subtle message instead of alert
    showSearchMessage('Нічого не знайдено за запитом: "' + query + '"');
  }
}

function resetSearch() {
  const items = document.querySelectorAll('.knowledge-item');
  const sections = document.querySelectorAll('.knowledge-section');
  
  items.forEach(function(item) {
    item.classList.remove('hidden', 'highlighted');
  });
  
  // Reset to default state (first section open)
  sections.forEach(function(section, index) {
    const content = section.querySelector('.section-content');
    const chevron = section.querySelector('.section-chevron');
    
    if (index === 0) {
      content.classList.remove('hidden');
      content.classList.add('block');
      if (chevron) chevron.style.transform = 'rotate(180deg)';
    } else {
      content.classList.add('hidden');
      content.classList.remove('block');
      if (chevron) chevron.style.transform = 'rotate(0deg)';
    }
  });
  
  hideSearchMessage();
}

function showSearchMessage(message) {
  let messageEl = document.getElementById('search-message');
  if (!messageEl) {
    messageEl = document.createElement('div');
    messageEl.id = 'search-message';
    messageEl.className = 'text-center py-8 text-gray-500 font-[Montserrat]';
    
    const container = document.querySelector('.max-w-5xl');
    if (container) {
      container.appendChild(messageEl);
    }
  }
  messageEl.textContent = message;
  messageEl.style.display = 'block';
}

function hideSearchMessage() {
  const messageEl = document.getElementById('search-message');
  if (messageEl) {
    messageEl.style.display = 'none';
  }
}
</script>
{{ end }}
