{{ define "main" }}
<section class="py-6 bg-white">
  <div class="max-w-[1237px] mx-auto px-5">
    <div class="mb-5 flex items-center justify-start gap-2 text-[var(--color-karma-red)] font-[Montserrat]">
      <a class="font-[Montserrat] lg:text-[20px] max-[420px]:text-[16px] font-normal text-[#ba0108]" href="/">
        Головна
      </a>
      <span class="text-[#ba0108]">&rarr;</span>
      <a class="font-[Montserrat] lg:text-[20px] max-[420px]:text-[16px] font-normal text-[#ba0108]" href="/knowledge-base">
        База знань
      </a>
      <span class="text-[#ba0108]">&rarr;</span>
      <a class="font-[Montserrat] lg:text-[20px] max-[420px]:text-[16px] font-normal text-[#ba0108]" href="#">
        {{ .Title }}
      </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-[280px_1fr_220px] gap-6">
      <div class="bg-[#fafafa] max-w-[285px] h-full rounded-2xl  border border-[#eee]">
        <aside class="hidden relative pt-0 pr-0 pl-0 lg:block">
          <div class="p-0">
            <nav class="pt-[8px] fixed" style="width: 285px; max-height: calc(100vh - 200px); overflow-y: auto;">
              {{ $categories := slice "БПЛА" "ВІДЕОПЕРЕДАВАЧІ" "ESC" }}
              {{ $guides := where .Site.RegularPages "Section" "guides" }}
              {{ range $index, $category := $categories }}
              {{ $categoryGuides := where $guides ".Params.category" $category }}
              <details class="asideDetails" {{ if eq $category $.Params.category }}open{{ end }}>
                <summary class="flex justify-between items-center px-4 py-3">
                  <span class="font-[Montserrat] font-normal text-[20px]">
                    {{ $category }}
                  </span>
                  <img src="/img/arrow.svg" alt="" width="18" height="18" class="asideIcon" />
                </summary>
                {{ if $categoryGuides }}
                <ul class="flex flex-col gap-[20px] b-l b-[#e0e0e0] ml-[36px] pr-[10px] max-w-[240px]"
                  style="border-left: 1px solid #e0e0e0; margin-left: 36px; padding-left: 16px;  padding-right: 10px; ">
                  {{ range $categoryGuides }}
                  <li>
                    <a href="{{ .Permalink }}" class="block  text-[16px] font-normal font-[Montserrat] {{ if eq .Title $.Title }}text-[#ba0108]{{ else }}hover:text-[#ba0108] transition-colors{{ end }}">
                      {{ .Title }}
                    </a>
                  </li>
                  {{ end }}
                </ul>
                {{ end }}
              </details>
              {{ end }}
            </nav>
          </div>
        </aside>
      </div>

      <div class="max-w-[693px] min-h-0 pr-2">
        <div class="flex relative max-w-[691px] justify-center items-center mb-5">
          <div class="flex flex-1 items-center">
            <div class="relative flex-1 rounded-[20px]">
              <input type="text" placeholder="Введіть текст"
                class="h-[47px] w-full !rounded-[20px] border border-[#E0E0E0] pl-4 pr-[120px] lg:text-[20px] max-[420px]:text-[16px] outline-none focus:border-[#ba0108] bg-white" />
              <button
                class="absolute z-10 right-0 top-1/2 -translate-y-1/2 w-[99px] h-[47px] rounded-[20px] bg-[#ba0108] flex items-center justify-center cursor-pointer hover:bg-[#a00007] transition-colors">
                <img src="/img/search-icon.svg" alt="search" width="30" height="30"
                  class="filter brightness-0 invert" />
              </button>
            </div>
          </div>
        </div>

        {{ if .Params.image }}
        <div class="relative overflow-hidden rounded-xl border border-[#E5E5E5]">
          <img src="{{ .Params.image }}" alt="{{ .Title }}" class="w-full h-auto" width="900" height="400" />
          <div class="absolute -top-10 -right-10 opacity-20">
            <img src="/img/bg-el-6.png" alt="" width="320" height="320" />
          </div>
        </div>
        {{ else }}
        <div class="relative overflow-hidden rounded-xl border border-[#E5E5E5]">
          <img src="/img/drone-man.png" alt="Drone Man" class="w-full h-auto" width="900" height="400" />
          <div class="absolute -top-10 -right-10 opacity-20">
            <img src="/img/bg-el-6.png" alt="" width="320" height="320" />
          </div>
        </div>
        {{ end }}

        <h1 class="mt-4 font-[Montserrat] text-[24px] font-medium text-black">
          {{ .Title }}
        </h1>
        {{ if .Params.description }}
        <p class="mt-2 font-[Montserrat] text-[16px] font-normal">
          {{ .Params.description }}
        </p>
        {{ end }}

        <div class="prose prose-lg max-w-none mt-8">
          <div class="text-gray-800 leading-relaxed font-[Montserrat]">
            {{ .Content }}
          </div>
        </div>
      </div>

      <aside class="hidden relative lg:block">
        <nav >
          <div class="pt-0 h-full">
            <nav class="fixed pt-[8px] " style="width: 285px; max-height: calc(100vh - 200px); overflow-y: auto;">
              <h4 class="mb-3 font-[Montserrat] text-[16px] font-medium text-[#ba0108]">
                На цій сторінці
              </h4>
              <ul class="space-y-2 text-[16px] font-normal font-[Montserrat]" id="page-toc">
                <!-- Table of contents will be generated by JavaScript -->
              </ul>
            </nav>
          </div>
        </nav>
      </aside>
    </div>
  </div>
</section>

<style>
  .asideDetails summary {
    list-style: none;
  }

  .asideDetails summary::-webkit-details-marker {
    display: none;
  }

  .asideIcon {
    transform: rotate(-90deg);
    transition: transform 200ms ease;
    cursor: pointer;
  }

  .asideDetails[open] .asideIcon {
    transform: rotate(0deg);
  }

  .asideDetails[open] .asideIcon {
    filter: brightness(0) saturate(100%) invert(8%) sepia(100%) saturate(7482%) hue-rotate(357deg) brightness(95%) contrast(118%);
  }

  .asideDetails[open] summary span {
    color: #ba0108 !important;
  }

  .chevronRight {
    transform: rotate(-90deg);
    opacity: 0.8;
  }

  .contentScrollable {
    overflow-y: auto;
    scroll-behavior: smooth;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .contentScrollable::-webkit-scrollbar {
    width: 0;
    height: 0;
  }

  .bg-\[\#fafafa\] {
    overflow: hidden;
  }

  nav.fixed::-webkit-scrollbar {
    width: 4px;
  }

  nav.fixed::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 2px;
  }

  nav.fixed::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 2px;
  }

  nav.fixed::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }

  /* Custom prose styles for better typography */
  .prose h2 {
    font-size: 1.25rem;
    font-weight: 400;
    color: #000;
    margin-top: 2.5rem;
    margin-bottom: 0.75rem;
    font-family: 'Montserrat', sans-serif;
    border-bottom: 1px solid #ba0108;
    padding-bottom: 0.75rem;
  }

  .prose h3 {
    font-size: 1.125rem;
    font-weight: 400;
    color: #000;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    font-family: 'Montserrat', sans-serif;
    border-bottom: 1px solid #ba0108;
    padding-bottom: 0.75rem;
  }

  .prose h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #000;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-family: 'Montserrat', sans-serif;
  }

  .prose p {
    margin-bottom: 1rem;
    line-height: 1.625;
    font-size: 1rem;
    font-family: 'Montserrat', sans-serif;
    color: #333;
  }

  .prose ul, .prose ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
    font-family: 'Montserrat', sans-serif;
    color: #333;
  }

  .prose strong {
    font-weight: 600;
    color: #000;
  }

  .prose em {
    font-style: italic;
  }

  .prose code {
    background-color: #f3f4f6;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: monospace;
  }

  .prose pre {
    background-color: #111827;
    color: #f3f4f6;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin-bottom: 1rem;
  }

  .prose blockquote {
    border-left: 4px solid #ba0108;
    padding-left: 1rem;
    font-style: italic;
    color: #374151;
    margin-bottom: 1rem;
  }

  .prose img {
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    margin: 1.5rem 0;
  }

  .prose a {
    color: #ba0108;
  }

  .prose a:hover {
    text-decoration: underline;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Generate table of contents
    const headings = document.querySelectorAll('.prose h2, .prose h3');
    const tocList = document.getElementById('page-toc');
    
    if (tocList && headings.length > 0) {
      headings.forEach((heading, index) => {
        // Create ID for heading if it doesn't exist
        if (!heading.id) {
          heading.id = 'heading-' + index;
        }
        
        // Create TOC item
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = '#' + heading.id;
        a.textContent = heading.textContent;
        a.className = 'block px-3 py-2 hover:text-[#ba0108] transition-colors';
        
        li.appendChild(a);
        tocList.appendChild(li);
      });
    }

    // Smooth scrolling for anchor links
    const anchorLinks = document.querySelectorAll('a[href^="#"]');
    anchorLinks.forEach((link) => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          targetElement.scrollIntoView({
            behavior: 'smooth',
            block: 'start',
          });
        }
      });
    });

    // Highlight active section in TOC
    const sections = document.querySelectorAll('.prose h2[id], .prose h3[id]');
    const navLinks = document.querySelectorAll('#page-toc a[href^="#"]');

    function highlightActiveSection() {
      let current = '';
      sections.forEach((section) => {
        const sectionTop = section.offsetTop;
        if (window.pageYOffset >= sectionTop - 200) {
          current = section.getAttribute('id');
        }
      });

      navLinks.forEach((link) => {
        link.style.color = '';
        if (link.getAttribute('href') === '#' + current) {
          link.style.color = '#ba0108';
        }
      });
    }

    window.addEventListener('scroll', highlightActiveSection);
    highlightActiveSection();
  });
</script>
{{ end }}
