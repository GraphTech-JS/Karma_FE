<!DOCTYPE html>
<html lang="{{ $.Site.Language.Lang }}">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
  <meta name="description"
    content="{{ with .Params.description }}{{ . }}{{ else }}{{ .Site.Params.defaultDescription }}{{ end }}">
  <meta name="keywords"
    content="{{ with .Params.keywords }}{{ . }}{{ else }}{{ .Site.Params.defaultKeywords }}{{ end }}">
  <meta name="author" content="{{ .Site.Params.author }}">
  <meta name="robots" content="{{ with .Params.robots }}{{ . }}{{ else }}index, follow{{ end }}">
  <link rel="canonical" href="{{ .Permalink | absURL }}">

  <!-- Critical CSS inline -->
  <style>
    html,
    body {
      font-family: 'Montserrat', ui-sans-serif, system-ui, sans-serif;
      box-sizing: border-box;
      overflow-x: hidden;
      margin: 0;
    }

    .hero-section {
      contain: layout style paint;
    }

    .swiper-container {
      overflow: hidden;
    }

    .swiper-wrapper {
      display: flex;
      transition: transform 0.3s ease;
    }

    .swiper-slide {
      flex-shrink: 0;
    }
  </style>

  <!-- Preload hashed build assets -->
  {{ if .Site.Data.webpack.main }}
  {{ $assets := .Site.Data.webpack.main }}
  <link rel="preload" href="{{ $assets.css | relURL }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="{{ $assets.css | relURL }}">
  </noscript>
  <link rel="preload" href="{{ $assets.js | relURL }}" as="script">
  {{ else if hugo.IsServer }}
  <!-- DEV fallback -->
  <link rel="stylesheet" href="http://localhost:3000/main.css">
  {{ else }}
  <!-- PRODUCTION fallback якщо webpack.json не знайдено -->
  <link rel="stylesheet" href="{{ "main.css" | relURL }}">
  {{ end }}

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Unbounded:wght@300;400;500;600;700&family=Wallpoet&display=swap"
    rel="stylesheet" media="print" onload="this.media='all'">
  <noscript>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Unbounded:wght@300;400;500;600;700&family=Wallpoet&display=swap"
      rel="stylesheet">
  </noscript>

  <!-- Social Meta (Open Graph + Twitter) -->
  <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
  <meta property="og:url" content="{{ .Permalink | absURL }}">
  <meta property="og:title"
    content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
  <meta property="og:description"
    content="{{ with .Params.description }}{{ . }}{{ else }}{{ .Site.Params.defaultDescription }}{{ end }}">
  <meta property="og:image"
    content="{{ with .Params.ogImage }}{{ . | absURL }}{{ else }}{{ .Site.Params.ogImage | absURL }}{{ end }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="{{ .Site.Title }}">
  <meta property="og:locale" content="{{ .Site.Language.Lang }}">

  <meta name="theme-color" content="{{ .Site.Params.themeColor }}">

  <!-- Netlify Identity Widget (async) -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js" async></script>

  <!-- Structured Data -->
  {{ if .IsHome }}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "{{ .Site.Title }}",
      "url": "{{ .Site.BaseURL }}",
      "logo": "{{ .Site.BaseURL }}img/logo.svg",
      "description": "{{ .Site.Params.description }}",
      "address": { "@type": "PostalAddress", "addressCountry": "UA", "addressLocality": "Україна" },
      "contactPoint": { "@type": "ContactPoint", "telephone": "+380672982929", "contactType": "Customer Service", "availableLanguage": ["Ukrainian","English"] },
      "sameAs": ["https://t.me/karma_flights","https://instagram.com/karma_flights"]
    }
  </script>
  {{ end }}
</head>

<body class="font-sans" itemscope itemtype="https://schema.org/WebPage">
  <a href="#main-content" class="sr-only focus:not-sr-only ...">Перейти до основного контенту</a>

  {{ block "header" . }}{{ partial "nav" . }}{{end}}
  <main id="main-content" role="main" tabindex="-1">
    {{ block "main" . }}{{ end }}
  </main>
  {{ block "footer" . }}{{ partial "footer" . }}{{end}}
  {{ partial "contact-modal" . }}

  <!-- JavaScript Loading -->
  {{ if .Site.Data.webpack.main }}
  {{ $assets := .Site.Data.webpack.main }}
  <script src="{{ $assets.js | relURL }}" defer></script>
  {{ else if hugo.IsServer }}
  <script src="http://localhost:3000/main.js"></script>
  {{ else }}
  <!-- PRODUCTION fallback -->
  <script src="{{ "main.js" | relURL }}" defer></script>
  {{ end }}

  <script>
    // Global function for contact modal
    window.openContactModal = function () {
      const modal = document.getElementById('contactModal');
      if (modal) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    };

    // Copy-to-clipboard buttons
    function addCopyButtons() {
      document.querySelectorAll('pre').forEach(function (pre) {
        const code = pre.querySelector('code');
        if (!code || pre.querySelector('.copy-btn')) return;

        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.innerHTML = '<img src="/img/copy.svg" alt="Copy" style="width:32px;height:32px;" />';
        button.style.cssText = 'position:absolute;top:8px;right:8px;...';
        pre.style.position = 'relative';
        button.onclick = async (e) => {
          e.preventDefault();
          try {
            await navigator.clipboard.writeText(code.textContent);
            button.innerHTML = '<img src="/img/copy-success.svg" alt="Copied" style="width:32px;height:32px;" />';
            setTimeout(() => button.innerHTML = '<img src="/img/copy.svg" alt="Copy"/>', 1000);
          } catch (err) { console.error(err); }
        };
        pre.appendChild(button);
      });
    }
    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', addCopyButtons); } else { addCopyButtons(); }
    setTimeout(addCopyButtons, 500);
  </script>
</body>

</html>